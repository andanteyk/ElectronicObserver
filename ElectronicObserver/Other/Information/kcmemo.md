## 艦これの仕様に関する雑多なメモ
---

#### 特注家具職人が必要な条件  
2000≦price<20000  
とくに特別なフラグはない。  

また、ダイナミック家具割引が有効になる条件は、  
price≧100000  
値引き後は `int( ( price - 100000 ) * 0.1 )` になる。  

#### ケッコンカッコカリ後の耐久値  
ケッコン前の最大耐久値及び「最大耐久値の最大値」にのみ依存する。艦種や艦型、ケッコンのタイミングなどの影響は受けない。
 
- HP < 30 : +4
- HP < 40 : +5
- HP < 50 : +6
- HP < 70 : +7
- HP < 90 : +8
- HP >= 90 : +9  

「最大耐久値の最大値」は艦ごとに個別に設定されており、この値を超えることはない。  
( 具体的には `api_start2.api_mst_ship.api_taik[1]` )  
殆どの艦では上記増分値を足しても問題ないほど大きく設定されているが、Bismarck drei など一部の艦娘はこれによって上昇量が制限されている。

#### パラメータの算出式  
対潜・回避・索敵の3種パラメータは、以下の式で求められる。  

```
value = min + int( ( max - min ) * Lv / 99 )  
```

なお、max = Lv. 99 時点での値。  
「改装して最大値は変わらないが最小値が上昇する艦娘」(島風の回避など)の場合、Lv. 100 を超えると改装前のほうが強くなることがある。  

火力・雷装・対空・装甲はレベルアップ時にランダムに上昇する(らしい)。  
なお、改装完了直後の火力・雷装・対空・装甲は、  

```
value = min + ceil( ( max - min ) * ( 0.4 or 0.8 ) * Lv / 99 )  
```

で求められる(0.4 or 0.8 はランダム)。  

#### 季節の衣替え艦娘  
クリスマス・年末・正月に衣装替えした艦娘のデータは ID 901 以降に保存されており、図鑑からのみ参照できる。  
~~なお、システム内では 501 以降の艦は深海棲艦として扱われるため、一応深海棲艦扱い。~~ 現在は修正済。  

> 2017/04/05 現在、ID: 900-1000 の領域がほぼ枯渇状態にあるため、新しい衣替え艦娘は ID: 900 から降順に追加されていっている。

2015/07/17アップデートによって、艦船マスターデータ(`api_mst_ship`)からデータが削除された。  
`api_mst_shipgraph` からのみアクセス可能となった。  

2016/05/02 アップデート('16 春イベ)時に、記念日シリーズ（具体的には、記念日夕雲・記念日長波・記念日春雨改・記念日瑞穂）の艦娘がマスターデータに追加された。  
理由としては、これらの艦娘には 900 以下のIDが降られており、クライアントに送信するマスターデータのフィルタ処理(ex. ID > 900 の艦娘は送信しない)から抜けてしまったものと考えられる。  
（なお、2016/05/03現在、従来の衣替え艦娘領域( 900 < ID < 1000 )はほぼ枯渇状態にある。それがID移動の原因かと考えられる。 ）  

2017/04/05 アップデートにより、敵艦IDの先頭が 501 → 1501 に変更された。それに伴ってフィルタ処理が変更されたのか、衣替え艦娘のデータがマスターから消滅した。  
引き続き図鑑や `api_start2` の画像位置設定からは参照可能。

2017/09/12 アップデートで、ID: 788 ～ 799 の艦娘がマスターに出現した。  
前回同様、フィルタから漏れてしまったものと思われる。  
なお、データフォーマットは深海棲艦のものと同一。  

2017/10/18 アップデートにより、衣替え艦娘がマスターから消滅した。

以下に 2017/10/18 時点における ID と対応する艦娘及び衣装を示す。  
なお、ID: 787～799, 811～900 以外の名称については(参照できないため)公式のものではない。

|ID|艦名|
|--:|:--|
|773|秋狭霧|
|774|浴衣綾波|
|775|浴衣敷波|
|776|浴衣藤波|
|777|浴衣古鷹|
|778|浴衣由良改二|
|779|浴衣神威|
|780|浴衣神威改|
|781|浴衣神威改母|
|782|浴衣択捉|
|783|浴衣松輪|
|784|浴衣Libeccio|
|785|秋刀魚Верный|
|786|秋刀魚卯月|
|787|浴衣朝霜|
|788|炒飯長波|
|789|夏Z1|
|790|夏海風|
|791|夏Commandant Teste|
|792|夏最上|
|793|夏2017三隈|
|794|夏伊401|
|795|夏U-511|
|796|夏呂500|
|797|瑞雲伊勢改|
|798|瑞雲日向改|
|799|瑞雲大淀改|
|800|瑞雲明石|
|801|瑞雲明石改|
|802|瑞雲速吸|
|803|瑞雲扶桑|
|804|瑞雲山城|
|805|梅雨漣|
|806|梅雨扶桑|
|807|梅雨神威|
|808|梅雨神威改|
|809|梅雨神威改母|
|810|買い物榛名|
|811|桃節句潮|
|812|桃節句潮改二|
|813|桃節句瑞穂|
|814|桃節句Commandant Teste|
|815|桃節句山風|
|816|Valentine水無月|
|817|Valentine朧|
|818|Valentine高波|
|819|ValentineCommandant Teste|
|820|節分明石|
|821|節分明石改|
|822|節分風雲|
|823|節分浦波|
|824|節分Commandant Teste|
|825|正月Iowa|
|826|正月鳳翔|
|827|正月山風|
|828|買い物Pola|
|829|Xmas鈴谷|
|830|Xmas熊野|
|831|Xmas朝雲|
|832|Xmas山雲|
|833|Xmas瑞穂|
|834|Xmas筑摩改二|
|835|Xmas利根改二|
|836|Xmasまるゆ|
|837|Xmas球磨|
|838|XmasCommandant Teste|
|839|Xmas明石改|
|840|Xmas明石|
|841|Xmas漣改|
|842|浴衣由良|
|843|浴衣白露|
|844|浴衣秋月|
|845|浴衣陸奥|
|846|浴衣長波|
|847|法被吹雪|
|848|法被吹雪改二|
|849|法被朝霜|
|850|法被夕雲|
|851|法被扶桑|
|852|秋刀魚多摩|
|853|秋刀魚あきつ丸|
|854|秋刀魚時雨改二|
|855|秋刀魚大鯨|
|856|秋刀魚龍鳳|
|857|秋刀魚Zara|
|858|親子丼秋雲|
|859|親子丼瑞穂|
|860|親子丼赤城|
|861|親子丼秋津洲|
|862|親子丼山城|
|863|親子丼夕立改二|
|864|買い出し金剛|
|865|買い出し金剛改二|
|866|買い出し天城|
|867|親子丼Roma|
|868|親子丼曙|
|869|夏2016曙|
|870|夏2016朧|
|871|夏2016朧改|
|872|夏風雲|
|873|夏沖波|
|874|夏五十鈴|
|875|夏扶桑|
|876|夏山城|
|877|夏瑞穂|
|878|夏大和|
|879|夏榛名改二|
|880|夏大鯨|
|881|夏龍鳳|
|882|夏三隈|
|883|夏大淀|
|884|夏大淀改|
|885|夏Libeccio|
|886|夏Z3|
|887|梅雨曙|
|888|梅雨早霜|
|889|梅雨清霜|
|890|梅雨瑞穂|
|891|梅雨夕立改二|
|892|梅雨最上|
|893|梅雨夕張|
|894|梅雨千歳|
|895|梅雨千代田|
|896|携帯白露|
|897|記念日夕雲|
|898|記念日長波|
|899|記念日春雨改|
|900|記念日瑞穂|
|901|Xmas那珂|
|902|Xmas那珂改二|
|903|Xmas時雨改二|
|904|Xmas龍驤|
|905|Xmas龍驤改二|
|906|Xmas漣|
|907|大掃除曙|
|908|正月夕立改二|
|909|正月明石|
|910|正月明石改|
|911|正月大淀|
|912|正月大淀改|
|913|Valentine睦月|
|914|Valentine如月|
|915|Valentine叢雲|
|916|Valentine時雨改二|
|917|Valentine浜風|
|918|梅雨祥鳳|
|919|梅雨村雨改|
|920|梅雨高波|
|921|夏朧|
|922|夏曙|
|923|夏漣|
|924|夏潮|
|925|夏潮改二|
|926|夏白露改|
|927|夏時雨改二|
|928|夏夕立改二|
|929|夏村雨改|
|930|夏天龍|
|931|夏龍田|
|932|夏明石改|
|933|夏Littorio|
|934|夏Italia|
|935|浴衣朧|
|936|秋刀魚磯風|
|937|秋刀魚磯風改|
|938|浴衣浦風|
|939|浴衣浜風|
|940|浴衣江風|
|941|オクトーバーフェストZ1|
|942|浴衣雷|
|943|浴衣電|
|944|浴衣長良|
|945|浴衣名取|
|946|浴衣球磨|
|947|浴衣多摩|
|948|浴衣大淀改|
|949|浴衣神通改二|
|950|浴衣瑞穂|
|951|秋の味覚曙|
|952|秋の味覚潮|
|953|秋の味覚潮改二|
|954|秋の味覚村雨|
|955|秋の味覚千歳|
|956|秋の味覚千代田|
|957|秋の味覚春雨|
|958|ハロウィンRoma|
|959|ハロウィンLibeccio|
|960|Xmas大淀|
|961|Xmas大淀改|
|962|Xmas谷風|
|963|Xmas初風|
|964|Xmas江風|
|965|XmasLittorio|
|966|XmasItalia|
|967|Xmas鹿島|
|968|正月潮|
|969|正月潮改二|
|970|正月子日|
|971|正月夕雲|
|972|正月巻雲|
|973|正月大鯨|
|974|正月香取|
|975|正月瑞穂|
|976|正月秋津洲|
|977|正月扶桑|
|978|正月山城|
|979|正月瑞鳳|
|980|正月瑞鳳改|
|981|正月天城|
|982|正月伊401|
|983|節分清霜|
|984|節分瑞穂|
|985|Valentine曙|
|986|Valentine衣笠改二|
|987|Valentine瑞穂|
|988|Valentine弥生|
|989|Valentine卯月|
|990|Valentine春雨|
|991|Valentine鹿島|
|992|Valentine叢雲改二|
|993|牛丼明石改|
|994|牛丼大淀改|
|995|牛丼時雨改二|
|996|牛丼龍驤改二|
|997|牛丼瑞穂|

なお、ID: 882 「夏三隈」について、2016/08/31 現在 API 上において「夏三隅」と誤記されている。  
更に、ID: 793 「夏2017三隈」について、2017/09/12 現在 API 上において「夏2017三隅」と誤記されている。  

ID: 787 「浴衣朝霜」について、艦種が「潜水艦」、艦型が「Guglielmo Marconi級」(80)となっている。  
おそらく、2017/09/29 現在艦娘で最大の(=衣替え艦に最も近い)IDを持つ Luigi Torelli改 のデータを流用したものと思われる。  

#### グラフィックの設定ミス

* ID: 822 「節分風雲」の艦名グラフィックが Commandant Teste になっている。
* ID: 187 「明石改」の補給画面グラフィックの左上が透過されていない。


#### SuperAAItem  
以下のアイテムが該当する。

* 3: 10cm連装高角砲
* 9: 46cm三連装砲
* 10: 12.7cm連装高角砲
* 35: 三式弾
* 48: 12.7cm単装高角砲

現在は未使用?  

#### 攻撃時の艦載機グラフィック

深海棲艦側は以下の通り。

* **1 (敵演習艦載機)**
    * IDにかかわらず、演習の艦載機は全てこれになる
    * 2016/11/04 現在、艦娘側と同じ仕様になったため未使用?
* **2 (緑)**
    * 下記装備に該当しないもの
* **3 (オレンジ)**
    * 517: 深海棲艦攻 Mark.II
    * 520: 深海棲艦戦 Mark.II
    * 524: 深海棲艦爆 Mark.II
* **4 (青)**
    * 518: 深海棲艦攻 Mark.III
    * 521: 深海棲艦戦 Mark.III
    * 525: 深海棲艦偵察機
    * 526: 飛び魚偵察機
    * 544: 深海爆雷投射機 Mk.II *※522: 飛び魚艦戦の設定ミス？*
    * 546: 飛び魚艦爆
* **5 (たこ焼き艦戦)**
    * 547: 深海猫艦戦
    * 566: 深海猫艦戦(爆装)
* **6 (たこ焼き艦爆)**
    * 548: 深海地獄艦爆
* **7 (たこ焼き艦攻)**
    * 549: 深海復讐艦攻
    * 564: 深海水上偵察観測機
* **8(たこ焼き水爆)**
    * 554: 深海水上攻撃機
* **9(たこ焼き水爆elite)**
    * 555: 深海水上攻撃機改
* **10(たこ焼き艦戦elite)**
    * 556: 深海猫艦戦改
* **11(たこ焼き艦爆elite)**
    * 557: 深海地獄艦爆改
* **12(たこ焼き艦攻elite)**
    * 558: 深海復讐艦攻改
* **13(たこ焼き陸爆)**
    * 561: 深海解放陸爆
* **14(たこ焼き陸爆Ace)**
    * 562: 深海解放陸爆Ace
* **15(たこ焼き水爆Flagship)**
    * 571: 深海水母子鬼機
* **16(たこ焼き艦戦Flagship)**
    * 572: 深海熊猫艦戦
* **17(たこ焼き潜水水爆)**
    * 573: 深海潜水下駄履き
* **18(鷹艦攻)**
    * 574: 深海攻撃哨戒鷹
    * 575: 深海攻撃哨戒鷹改

味方側(演習の敵艦隊を含む)の航空機グラフィックは、装備マスターデータの `api_type[4]` をもとにして決定される。  
最新の情報は apilist.txt を、各航空機の分類は `api_start2` を参照せよ。


#### ダメージ処理  
実際のダメージにかかわらず、15未満だと常に非クリティカル, 40以上だと常にクリティカルとして表示される。  
また、「命中/クリティカルしたが0ダメージ」という状況も存在する。  
実際に出せるかはさておき、表示上の最大値は9999。  
「かばう」が発動した場合は 0.1 がフラグとして加算される(もちろん実ダメージには影響しない)。  
連合艦隊戦において、第二艦隊旗艦にかばうフラグが立つことがある（航空戦）。実際はどうなっているのか不明。  

#### 消費アイテム装備使用の優先度  

* ダメコン・戦闘糧食
    * 補強スロット ＞ メインスロット[0] ＞ … ＞ メインスロット[4]
* 洋上補給
    * 補強スロット ＞ メインスロット[4] ＞ … ＞ メインスロット[0] 

以上の順で発動・消費される。 
なお、発動した後は削除して詰めた後 -1 が末尾に補充される(補強スロットの場合は -1 に置換される)。  
削除処理は発動直後に行われ、同戦闘中の表示にも反映される(はず)。  

洋上補給の消費優先度については、

* 本隊6番艦 > ... > 本隊旗艦 [ > 随伴6番艦 > ... > 随伴旗艦 ]

となっている。洋上補給が可能な艦が複数存在する場合、この順に消費が行われる。

なお、旗艦大破ダメコン進撃時の消費判定は、次の戦闘が始まる直前に行われる。  
戦闘前に帰投したり再読み込みしたりした場合、消費も回復も発動しない。  
[実験時の様子はこちら。](https://twitter.com/andanteyk/status/727764443942277121)  


#### 探照灯の優先度
発動条件(HP>1)を満たす艦が複数いた場合は、

* (大型探照灯＞探照灯)＞旗艦に近いほう

の優先度で発動させる(1隻のみ)。  
条件を満たしていれば確実に発動するため、戦闘APIに対応する値は存在しない。

#### 熟練見張員の発動エフェクトについて
カットイン攻撃が発生した際、熟練見張員を装備していれば確実にエフェクトが発動する。  
そのため戦闘APIに対応する値は存在しない。

#### 挟叉  
命中フラグは以下のようになっている。  

* `HITFLG_NOATTACKED` : 攻撃せず(-1)
* `HITFLG_MISS` : ミス(0)
* `HITFLG_NORMAL` : 命中(1)
* `HITFLG_CRITICAL` : クリティカル(2)
* `HITFLG_KYOUSA` : 狭叉(3) (原文ママ, 未実装?)  

#### 航空支援について  
* 航空支援でも敵機を撃墜することは可能。  
ただし既に航空戦フェーズは終わっているので、狙ってまでする事ではなさそう。  
* 制空戦力は**熟練度を無視して**計算される。制空戦力の強い敵艦隊に出すときは注意が必要。

#### レアリティの設定ミス  
以下に示す艦娘は、設定されたレアリティとグラフィック上のレアリティが異なる。  
なお、レアリティ値は8段階であり、 藍＜青＜水＜銀＜金＜虹＜輝虹＜桜虹 とする。

|艦船ID|艦名|設定レアリティ|グラフィック|
|--:|:--|:--|:--|
|143|武蔵|輝虹|桜虹|
|148|武蔵改|輝虹|桜虹|
|194|羽黒改二|金|虹|
|197|蒼龍改二|桜虹|輝虹|
|348|瑞穂改|金|虹|
|350|海風改|銀|金|
|364|Warspite改|桜虹|輝虹|
|365|Aquila改|桜虹|輝虹|
|384|松輪改|銀|金|
|392|Richelieu改|桜虹|輝虹|
|393|Ark Royal改|桜虹|輝虹|
|450|秋津洲改|桜虹|輝虹|
|461|翔鶴改二|桜虹|輝虹|
|462|瑞鶴改二|桜虹|輝虹|
|465|鹿島|水|銀|
|466|翔鶴改二甲|桜虹|輝虹|
|467|瑞鶴改二甲|桜虹|輝虹|
|490|荒潮改二|銀|輝虹|
|496|Zara due|桜虹|輝虹|
|508|鈴谷航改二|桜虹|輝虹|
|509|熊野航改二|桜虹|輝虹|
|541|長門改二|桜虹|輝虹|
|545|Saratoga Mk.II|桜虹|輝虹|
|550|Saratoga Mk.II Mod.2|桜虹|輝虹|

この設定レアリティは建造・ドロップ時及び撃沈時の背景表示に用いられるため、それらのシーンではカードグラフィックと背景が一致しない状態になる。

#### 撃沈・退避時のグラフィック  
R' = G' = B' = ( R + G + B ) / 3

#### ダメコン使用時の回復量
- 応急修理要員 : HP = int( HPMax * 0.2 )
    - 旗艦大破進撃時は HP = int( HPMax * 0.5 )
- 応急修理女神 : HP = HPMax ( +燃料・弾薬全回復 )  

#### 保有数による出撃時の制限  
なお、「装備空き」は補正後の値(艦これクライアントの表示値)に従う。

* 艦船がドロップしない条件  
艦船空き == 0 or 装備空き <= 3  
* イベント海域出撃不可条件  
艦船空き < 5 or 装備空き < 20



#### 攻撃種別決定について

攻撃種別判定には、以下のパラメータが用いられる。

* 昼戦攻撃種別ID (サーバから受信: `api_at_type`)
    * 0: 通常攻撃
    * 1: レーザー攻撃 (廃止)
    * 2: 連続射撃
    * 3: カットイン(主砲/副砲)  
    * 4: カットイン(主砲/電探)
    * 5: カットイン(主砲/徹甲弾)
    * 6: カットイン(主砲/主砲)
    * 7: 空母カットイン

* 夜戦攻撃種別ID (サーバから受信: `api_sp_list`)
    * 0: 通常攻撃
    * 1: 連続攻撃
    * 2: カットイン(主砲/魚雷)
    * 3: カットイン(魚雷/魚雷)
    * 4: カットイン(主砲/主砲/副砲)
    * 5: カットイン(主砲/主砲/主砲)
    * 6: 空母カットイン
    * 7: 駆逐カットイン(主砲/魚雷/電探)
    * 8: 駆逐カットイン(魚雷/電探/見張員)

* 通常攻撃ID
    * 0: 砲撃 / その他
    * 1: 空撃
    * 2: 爆雷攻撃
    * 3: 雷撃

* ロケット攻撃フラグ (bool)

* 揚陸攻撃ID
    * 0=なし
    * 1=大発動艇
    * 2=特大発動艇
    * 3=大発動艇(八九式中戦車＆陸戦隊)
    * 4=特二式内火艇
    * 5=特大発動艇+戦車第11連隊

* 空母夜間攻撃フラグ (サーバから受信: `api_n_mother_list`; == 1 なら true)

* 表示装備 (サーバから受信: `api_si_list`)
    * 装備のマスターIDリストであり、カットイン表示に用いられる

以上のうち、 "サーバから受信" と書いていないものについては、クライアント側で計算される。


##### 昼戦

昼戦におけるクライアント側の攻撃種別決定処理は以下の通り。

```
if ( 対地装備 を装備している && 防御側.地上施設である )
    ロケット攻撃フラグ = true;

揚陸攻撃ID = 揚陸攻撃ID取得();

if ( 攻撃側 == 速吸改 ) {
    if ( 防御側.潜水艦系である ) {        // 厳密には 防御側.艦種 == ( 潜水艦 | 潜水空母 )
        if ( ( 対潜 > 0 の艦上攻撃機 ) or 水上爆撃機 or オートジャイロ を装備している )
            通常攻撃ID = 1(空撃);
        else
            通常攻撃ID = 2(爆雷攻撃);
    } else if ( 艦上攻撃機 を装備している )
        通常攻撃ID = 1(空撃);
    else
        通常攻撃ID = 0(砲撃);
} else if ( 攻撃側.空母系である ) {      // 厳密には 攻撃側.艦種 == ( 軽空母 | 正規空母 | 装甲空母 ) 
    通常攻撃ID = 1(空撃);
} else if ( 防御側.潜水艦系である ) {
    if ( 攻撃側.艦種 == ( 航空巡洋艦 | 航空戦艦 | 水上機母艦 | 揚陸艦 ) )
        通常攻撃ID = 1(空撃);
    else
        通常攻撃ID = 2(爆雷攻撃);
} else if ( 表示装備[0].カテゴリ == ( 魚雷 | 潜水艦魚雷 ) ) {
    通常攻撃ID = 3(雷撃);
} else {
    通常攻撃ID = 0(砲撃);
}
```

上記判定が行われた後、実際に何が発生するかを決定する。  
(どれかの条件を満たし次第 return するものとする)

```
if ( ロケット攻撃フラグ == true )
    ロケット攻撃;
switch ( 昼戦攻撃種別ID ) {
    case 1:     throw;      // 実際に例外が発生する
    case 2:     連続射撃;
    case 3:     カットイン(主砲/副砲);
    case 4:     カットイン(主砲/電探);
    case 5:     カットイン(主砲/徹甲);
    case 6:     カットイン(主砲/主砲);
    case 7:     空母カットイン;
    default:
        switch ( 通常攻撃ID ) {
            case 1:     空撃;
            case 2:     爆雷攻撃;
            case 0:     砲撃;
            default:    throw;
        }
}
```

「レーザー攻撃」「雷撃」は昼戦では発生しない (もし指定された場合、例外が発生する)。  
また、ロケット攻撃は特殊攻撃より優先度が高いため、「見た目は単発だが内部的には連続射撃」といった状態も発生しうる。

##### 夜戦

夜戦におけるクライアント側の攻撃種別決定処理は以下の通り。

```
if ( 対地装備 を装備している && 防御側.地上施設である )
    ロケット攻撃フラグ = true;

揚陸攻撃ID = 揚陸攻撃ID取得();

if ( 夜戦空母攻撃フラグ == true ) {
    通常攻撃ID = 1(空撃);
} else if ( 攻撃側.艦種 == 軽空母 && 防御側.潜水艦系である ) {
    通常攻撃ID = 2(爆雷攻撃);
} else if ( 攻撃側.空母系である ) {
    if ( 攻撃側 == ( Graf Zeppelin | Graf Zeppelin改 | Saratoga ) || 攻撃者.艦名 == ( リコリス棲姫 | 深海海月姫 ) )
        通常攻撃ID = 0(砲撃);
    else
        通常攻撃ID = 1(空撃);
} else if ( 攻撃側.潜水艦系である ) {
    通常攻撃ID = 3(雷撃);
} else if ( 防御側.潜水艦系である ) {
    if ( 攻撃側.艦種 == ( 航空巡洋艦 | 航空戦艦 | 水上機母艦 | 揚陸艦 ) )
        通常攻撃ID = 1(空撃);
    else
        通常攻撃ID = 2(爆雷攻撃);
} else if ( 表示装備[0].カテゴリ == ( 魚雷 | 潜水艦魚雷 ) ) {
    通常攻撃ID = 3(雷撃);
} else {
    通常攻撃ID = 0(砲撃);
}
```

上記判定が行われた後、実際に何が発生するかを決定する。  
(どれかの条件を満たし次第 return するものとする)

```
if ( 夜戦攻撃種別ID == 0 ) {
    if ( ロケットフラグ == true )
        ロケット攻撃;
    switch ( 通常攻撃ID ) {
        case 1:     空撃;
        case 2:     爆雷攻撃;
        case 3:     雷撃;
        default:    砲撃;
    }
} else if ( 夜戦攻撃種別ID == 1 ) {
    if ( 表示装備[0].カテゴリ == ( 小口径主砲 | 中口径主砲 | 大口径主砲 | 副砲 | 大口径主砲(II) ) )
        連続射撃;
    else
        連続雷撃;
} else if ( 夜戦攻撃種別ID == 6 ) 空母カットイン;
else {
    switch ( 夜戦攻撃種別ID ) {
        case 2:     カットイン(主砲/魚雷);
        case 3:     カットイン(魚雷/魚雷);
        case 4:     カットイン(主砲/副砲);
        case 5:     カットイン(主砲/主砲);
		case 6:     駆逐カットイン(主砲/魚雷/電探);
		case 7:     駆逐カットイン(魚雷/電探/見張員);
		default:    カットイン(主砲/主砲);
    }
}
```

昼戦とは異なり、通常発生しないもの(連続雷撃、指定外の値)でも例外は発生しない。  
また、夜戦では昼戦と異なり特殊攻撃発生時はロケット攻撃にならない。  

##### 揚陸攻撃

```
int 揚陸攻撃ID取得() {
    特殊攻撃対象名 = ( 離島棲姫 | 砲台小鬼 | 集積地棲姫 | 集積地棲姫-壊 );

    if ( 特大発動艇+戦車第11連隊 を装備している && 防御側.地上施設である )
        return 5;
    if ( 特二式内火艇 を装備している ) {
        if ( 攻撃側.潜水艦系である ) {
            if ( 防御側.地上施設である )
                return 4;
        } else if ( 防御側の名前 == 特殊攻撃対象名 )
            return 4;
    }
    if ( 大発動艇(八九式中戦車&陸戦隊) を装備している && 防御側の名前 == 特殊攻撃対象名 )
        return 3;
    if ( 特大発動艇 を装備している && 防御側の名前 == 特殊攻撃対象名 )
        return 2;
    if ( 大発動艇 を装備している && 防御側の名前 == 特殊攻撃対象名 )
        return 1;

    return 0;
}
```

攻撃種別が ( 砲撃, 空撃, 爆雷攻撃, 雷撃, ロケット攻撃, 空母カットイン ) のいずれかであり、揚陸攻撃ID > 0 ならば、追加で対応する揚陸攻撃エフェクトが発生する。  
なお、揚陸攻撃ID > 0 の時は、一部攻撃種別で装備カットインが表示されなくなる。  


参考の継承図：

```
PhaseBase
    PhaseDayNightBase       ダメコン発動処理
        PhaseAttackBase     夜戦ボイス再生処理？
            PhaseAttackNormal   砲撃 *
            PhaseBakurai        爆雷攻撃 *
            PhaseDaySuperBase   昼間カットイン攻撃
                PhaseDaySuper1  偵察/主砲/副砲
                PhaseDaySuper2  偵察/電探/主砲
                PhaseDaySuper3  偵察/主砲/徹甲弾
                PhaseDaySuper4  偵察/主砲/主砲
            PhaseDoubleH        連続射撃
            PhaseDoubleR        連続雷撃
            PhaseKansaiki       空撃 *
            PhaseKuboCutin      空母カットイン *
            PhaseRocket         ロケット攻撃 *
            PhaseTorpedo        雷撃 *
        PhaseHougekiBase    昼戦攻撃種別優先度
        night/PhaseAttack   夜戦攻撃種別優先度

phase/combat に API ごとの戦闘の流れが書いてある

* は揚陸攻撃エフェクトが発生するもの
```


#### 夜戦魚雷連撃  
一応実装されているらしい。  
連撃フラグが立っており、かつ攻撃表示装備[0]が( 小口径主砲/中口径主砲/大口径主砲/大口径主砲(II)/副砲 )でないときに発動する。  
そういったデータが送られてくることはないので通常の手段では見ることはできない。  


#### 対空カットイン  

|ID|必要装備|発動可能艦|
|--:|:--|:--|
| 1|高角砲x2/電探|秋月型|
| 2|高角砲/電探|秋月型|
| 3|高角砲x2|秋月型|
| 4|大口径主砲/三式弾/高射装置/電探||
| 5|高角砲+高射装置x2/電探||
| 6|大口径主砲/三式弾/高射装置||
| 7|高角砲/高射装置/電探||
| 8|高角砲+高射装置/電探||
| 9|高角砲/高射装置||
|10|高角砲/集中機銃/電探|摩耶改二|
|11|高角砲/集中機銃|摩耶改二|
|12|集中機銃/機銃/電探||
|13|???||
|14|高角砲/機銃/電探|五十鈴改二|
|15|高角砲/機銃|五十鈴改二|
|16|高角砲/機銃/電探|霞改二乙|
|17|高角砲/機銃|霞改二乙|
|18|集中機銃|皐月改二|
|19|高角砲(非高射装置)/集中機銃|鬼怒改二|
|20|集中機銃|鬼怒改二|
|21|高角砲/電探|由良改二|
|22|集中機銃|文月改二|
|23|機銃(非集中)|UIT-25以降|

秋月型のみ対空電探でなくても可。  

なお、特殊装備の条件は以下の通り：

* 対空電探 : 対空 >= 2 の電探
* 高角砲+高射装置 : 対空 >= 8 の高角砲
* 集中機銃 : 対空 >= 9 の機銃


#### 敵ボイス  
`areaID` `mapNo` `index` `shipID`  

#### 装備種別  
`api_start2.api_mst_slotitem.api_type` 配列における、インデックスごとの意味は以下の通り。

* 0: 大分類？
* 1: 図鑑カテゴリ/戦闘分類
* 2: 装備種別(いわゆる装備カテゴリ。 `api_mst_slotitem_equiptype` に対応)
* 3: アイコン
* 4: 航空機グラフィック種別

詳細については apilist.txt を参照すること。


#### 対空能力の優先度？  
ある部分で使われている処理。何かの助けになるかもしれない

```
int flag = 0;
foreach ( 装備スロット ) {
	int priority = 0;
	if ( カテゴリ == 対空強化弾 ) priority = 1;
	else if ( アイコン == 高角砲 ) priority = 3;
	else if ( 装備 == 12cm30連装噴進砲 ) priority = 2;
	else if ( カテゴリ == 対空機銃 ) priority = 4;
	else if ( アイコン == 電探 && 対空 > 0 ) priority = 4;

	if ( priority > 0 && ( priority < flag || flag == 0 ) )
		flag = priority;	//優先度の高いものを選択
}
if ( flag == 2 ) flag = 3;
else if ( flag == 3 ) flag = 2;		//謎のスワップ 
return flag;
```

#### 泊地修理の仕様

用語を以下のように定義する。

* 「泊地修理タイマ」は各プレイヤーに1つだけ存在する。これは修理を開始した時にその時刻がセットされるものである(要するに `DateTime` 型の変数だと思えばよい)。  
* 泊地修理タイマに現在の時刻をセットすることを「スタート」とする。スタートしたとき、以前に設定されていた時刻は上書きされる。  
* 「修理可能な艦」は、入渠しておらず、遠征中ではない、 `50% < HP < 100%` である艦のことである。

「通常の編成を行った結果、旗艦が工作艦であるとき」に、タイマはスタートする。編成操作に工作艦が直接関わる必要はない。具体的には以下の状態などが挙げられる。

* 旗艦に工作艦を配置した
* 2番艦に工作艦がいるときに、1番艦をはずした
* 旗艦に工作艦がいるときに、2番艦と3番艦を入れ替えた
* 第1艦隊で旗艦に工作艦がいるときに、第2艦隊に第1艦隊の随伴艦を移動した

なお、「編成」は `api_req_hensei/change` を用いるものの一部（艦の追加/はずす/入れ替え/D&Dによる操作）であり、**随伴艦一括解除・編成記録/展開による編成・解体や近代化改修による除籍は含まない**。  
(撃沈による除籍は未確認であるが、おそらく解体と同じ扱いをされると思われる)  
また、工作艦が旗艦でない艦隊の編成操作はタイマに影響を及ぼさない。  
タイマのスタートでは、**旗艦(工作艦)の状態(入渠中、中破など)、修理可能な艦がいるかは一切問わない**。工作艦が旗艦でさえあればよい。  

よって、「編成」として扱われない編成記録/展開を利用することで、タイマを再スタート(リセット)させることなく編成の変更を行うことができる。  

母港に移動したときに下記の修理判定が行われる。  

* 「泊地修理タイマが20分経過していない場合」は、なにもしない
* 「泊地修理タイマが20分以上経過している場合」は、下記の修理実行判定を行う
    * 判定に成功すれば経過時間に応じてHPを回復する。
    * *判定の成否にかかわらず*、泊地修理タイマをスタートする。

修理実行判定は以下のすべてを満たせば成功である。

* 旗艦が中破していない
* 旗艦が入渠中でない
* 艦隊が遠征中でない
* 修理可能な艦が旗艦を含めて `(2 + 艦艇修理施設の装備数)` の範囲内に存在する
* 修理に必要な資源が足りている(注)

> (注) 資源の自然回復は、修理判定の後に行われる。そのため、自然回復で増えた資源はこの判定では無視される。  
> なお、艦隊の先頭から順に修理処理を行っていく。資源が足りなければその艦はスキップされる。  

実験時のログを以下に示す。

```
05:28 泊地修理開始　HP54
05:48 回復確認 HP55　同刻(15秒程)、「雷」を編成(リセット)
05:54 「雷」を解体
06:08 回復確認 HP56
06:13 小破未満ダメージの「明石」を編成記録、別の無傷明石を編成し修理開始
06:19 ダメージ「明石」編成展開、入渠を開始　直後に無傷明石を再度編成展開
06:33 回復確認 HP57
06:42 無傷「武蔵」に僚艦変更　ダメージ艦がいない状態に
06:45 小破未満ダメージ「伊勢」を編成展開
07:02 回復確認 HP58

09:49 中破「明石」を旗艦にして編成変更(リセット)　HP30
09:52 無傷「明石」の編成を展開
10:09 回復確認 HP31
10:11 入渠(中破)明石を旗艦にして編成変更(リセット)
10:15 バケツで明石を回復
10:31 回復確認 HP32

10:56 旗艦を工作艦以外にしてから20分以上経過した状態で、明石を編成展開(そのまま母港には戻らない)
11:17 母港に移動、回復確認 HP33
11:38 同様にタイマをリセットしてから明石を編成展開して母港に戻らず放置
11:52 母港に移動 変化なし
11:58 回復確認 HP34

14:20 「摩耶」を編成(リセット)
14:29 「摩耶」を近代化改修により除籍
14:42 回復確認

14:54 無傷艦のみで編成
15:15 母港に戻る
15:25 ダメージ艦を編成展開　HP67
15:35 回復確認　HP68

15:47 明石旗艦、天津風(HP36/39)随伴、遠征隊出発(長距離練習航海)
16:12 母港へ戻る　当然回復せず
16:16 遠征帰投　回復せず
16:32 回復確認 HP37

21:05　修理開始
21:15　随伴艦一括解除
21:20　編成展開で修理可能艦を編成
21:25　回復確認

23:14　修理開始
23:26　ダメージ艦を1隻第3艦隊に移動(第3艦隊側から操作)
23:34　修理されず(別艦隊からの編成でもタイマがリセットされる)

23:46　修理から20分経過後に母港を開く(非修理編成)
23:57　編成展開で修理可能艦を編成
00:06　回復確認
```

ツールの実装としては、

* `api_req_hensei/change` で変化した艦隊の旗艦が工作艦なら `timer = Now` ※但し随伴艦一括解除の場合は無視する
* `api_port/port` で、`( Now - timer ) >= 20min` なら `timer = Now`

でほぼ再現できるはずである。

参考文献：[【プリセット明石修理】明石カウンターの詳細についての仮説 及びツール作成者様に対応お願いしたいことについて:ﾆﾗのブロマガ - ブロマガ](http://ch.nicovideo.jp/nila/blomaga/ar904333)


#### 泊地修理における HP 回復量

実験より、以下のように推測する。

```
被ダメージ = 最大HP - 修理前HP
回復HP = floor( floor( 修理秒数 / 60 ) * 60 / ( 入渠秒数 / 被ダメージ ) )

(但し、 1 <= 回復HP <= 被ダメージ )
```

簡単に言えば、修理した分数(秒部は切り捨て) を 1HPあたりの回復時間 で割った値となる。  
なお、 `入渠秒数` は API から得られた値 (=艦これクライアントの「入渠」画面で表示される値) である (小数点以下を含む)。

逆に、HPをある値回復したい場合の最低修理時間は以下のようになる。

```
if ( 回復HP == 1 )
    修理秒数 = 1200
else
    修理秒数 = ceiling( 回復HP * 入渠秒数 / 被ダメージ / 60 ) * 60

(但し、 修理秒数 >= 1200 )
```

従って、泊地修理によって完全回復させるために必要な時間は、入渠時間を分単位で切り上げたものとなる。  

実験データは長くなるので[こちら](https://www.dropbox.com/s/5aqel7lmg1r3l1z/AnchorageRepairTest.xlsx?dl=0)を参照。


#### 時報の読み込みタイミング  
サーバの混雑を回避するためか、時間の5分ほど前から読み込みを開始することがある。  
詳細は未調査。  

#### 戦闘勝利判定  

```
＊＊艦船数 = 戦闘開始時の艦船数
＊＊撃沈数 = 戦闘終了時に撃沈されている艦船数
味方損害率 = int( ( 味方開始時HP - 味方終了時HP ) / 味方開始時HP * 100 );
敵損害率 = int( ( 敵開始時HP - 敵終了時HP ) / 敵開始時HP * 100 );

if ( 味方撃沈数 == 0 ) {
    if ( 敵撃沈数 == 敵艦船数 ) {
        if ( 味方終了時HP >= 味方開始時HP )       // ダメコンにより開始時より大きくなることがある
            return SS;
        else
            return S;

    } else if ( 敵艦船数 > 1 && 敵撃沈数 >= int( 敵艦船数 * 0.7 ) ) {
        return A;
    }
}

if ( 敵旗艦撃沈 && 味方撃沈数 < 敵撃沈数 )
    return B;

if ( 味方艦船数 == 1 && 味方旗艦大破 )
    return D;

if ( 敵損害率 > 2.5 * 味方損害率 )
    return B;

if ( 敵損害率 > 0.9 * 味方損害率 )
    return C;

if ( 味方撃沈数 > 0 && 味方艦船数 - 味方撃沈数 == 1 )
    return E;

return D;

```

なお、退避艦は計算から除外する。(艦船数/損害率に含めない)

##### 長距離空襲戦での勝利判定
'16 冬イベで実装された長距離空襲戦では、こちらから攻撃できないためか、一般の勝利判定とは計算が異なる模様。  
2016/02/19 現在、以下のように推測されている。

```
味方損害率 = int( ( 味方開始時HP - 味方終了時HP ) / 味方開始時HP * 100 );

if ( 味方損害率 <= 0 )
    rank = SS;
else if ( 味方損害率 < 10 )
    rank = A;
else if ( 味方損害率 < 20 )
    rank = B;
else if ( 味方損害率 < 50 )
    rank = C;
else if ( 味方損害率 < 80 )
    rank = D;
else
    rank = E;
```

通常時とは異なり、撃沈艦の有無は勝利判定に含まない模様（撃沈1隻でもA勝利が、撃沈艦なしでもE敗北が取れる）。  

#### 一度に大破できる艦数  
表示上は3隻まで。当然であるが中大破自体はおそらく何隻でも可能。  
[スクリーンショットはこちら](https://twitter.com/andanteyk/status/655400064278360064)。  

#### 連合艦隊における電探の渦潮被害軽減効果  
艦隊ごとに判定されるため、どちらの艦隊にも載せる必要がある。  
なお、'16 夏イベントの E-4 で、第一艦隊にのみ燃料ダメージを与える渦潮が確認されている。  
API 上は通常の(随伴艦隊にもダメージを与える)ものと区別はできない。  

#### '15 冬イベントの海域ゲージHP  
全て甲作戦のもの。

* E-1 : 192 (旗艦HP45; 最低5回撃破)
* E-2 : 720 (旗艦HP通常96/最終160 160以下で最終形態 最低7回撃破)
* E-3 : 1050 (旗艦HP270; 最低4回撃破)
* E-4 : 1925 (旗艦HP350; 最低6回撃破)
* E-5 : 3000 (旗艦HP500; 最低6回撃破)

#### '15 春イベントの海域ゲージHP  
全て甲作戦のもの。

* E-1 : 440 (旗艦HP88; 最低5回撃破)
* E-2 : 1620 (旗艦HP270; 最低6回撃破)
* E-3 : 910 (旗艦HP130; 最低7回撃破)
* E-4 : 3200 (旗艦HP450(最終形態500); 最低7回撃破)
* E-5 : 2410 (旗艦HP330(最終形態430); 最低7回撃破)
* E-6 : 3405 (旗艦HP500; 最低7回撃破)

#### '15 夏イベントの海域ゲージHP
全て甲作戦、司令部Lv120のもの。

* E-1 : 750 (旗艦HP150; 最低5回撃破)
* E-2 : 1050 (旗艦HP270; 最低4回撃破)
* E-3 : 2100 (旗艦HP350; 最低6回撃破)
* E-4 : 3500 (旗艦HP500; 最低7回撃破)
* E-5 : 2450 (旗艦HP400; 最低7回撃破)
* E-6 : 2800 (旗艦HP350; 最低8回撃破)
* E-7 : 2040 (旗艦HP255; 最低8回撃破)

#### 海域HPゲージ  
* わずかでもダメージを与えないと正常な値にならない。  
    (ex. 初期は300/300でも、30ダメージ与えると2370/2400になる、など)  
    最大HPが1000以上だと正しく取得できる？  
* '15冬イベ以前は初期値300、'15冬イベ以降は9999  
* '15春イベでは難易度を選択した時点で決定される？  
* '15春イベ/夏イベにて、司令部Lvによって海域HPが変化する仕様が確認されている。
* ボスが最終形態になるかどうかは、前哨戦のボスHPに依存する模様(前哨戦ボスHP600ならば、600以下になった時に最終形態に移行する)。  
    そのため、 `前哨戦HP > 最終戦HP` の場合、最終形態を複数回倒さなければならない。

#### 猫った時のAPIレスポンス  
練習巡洋艦旗艦で開発すると落ちる不具合を利用したもの。(2015/02/08)  

* `api_result` : 100  
* `api_result_msg` : "申し訳ありませんがブラウザを再起動し再ログインしてください。"

`api_result` については、201などといった値をとることもある。

また時々、もはや JSON ですらない HTML データが送られてくることもある。  
内容は主にデータベースエラーのログであり、エラーが発生した PHP ファイルのパスやレコード名などを知ることができる。

#### 特殊な装備判定(改装UI)  
Bismarck dreiに対する魚雷装備・試製51cm連装砲といったものの装備判定は、改装UIシステムの中で*例外的に決め打ち*されている。  
具体的には、以下のようになっている。

|対象艦ID|対象艦|装備可能|装備不可能|
|:--|:--|:--|:--|
|131, 143|大和, 武蔵|大口径主砲(II)||
|136, 148, 275, 276|大和改, 武蔵改, 長門改, 陸奥改|大口径主砲(II), 水上戦闘機||
|146, 216, 217|木曽改二, 多摩改, 木曽改|追加装甲(中型)||
|147|Верный|上陸用舟艇, 追加装甲(中型), 特型内火艇||
|178|Bismarck drei|魚雷||
|199, 418, 468, 487, 489, 490, 548|大潮改二, 皐月改二, 朝潮改二丁, 鬼怒改二, 満潮改二, 荒潮改二, 文月改二|上陸用舟艇, 特型内火艇||
|200|阿武隈改二|特殊潜航艇, 上陸用舟艇, 特型内火艇||
|343, 356|香取改, 鹿島改|探照灯||
|352|速吸改|艦上攻撃機, 大型電探, ソナー, 上陸用舟艇, 特型内火艇||
|358, 361, 446, 447|Zara改, Pola改, Italia, Roma改|水上爆撃機, 水上戦闘機||
|372|Commandant Teste改|ソナー, オートジャイロ, 航空要員, 大型探照灯, 輸送機材|爆雷, 特殊潜航艇|
|380|大鷹改|ソナー, 爆雷|艦上偵察機, オートジャイロ, 大型ソナー|
|434, 435, 469|睦月改二, 如月改二, 江風改二|上陸用舟艇||
|445|秋津洲|大型飛行艇, 輸送機材|特殊潜航艇, 上陸用舟艇, 対地装備, 特型内火艇|
|450|秋津洲改|大型飛行艇, ソナー, 航空要員, 輸送機材|特殊潜航艇|
|464|霞改二|上陸用舟艇, 司令部施設, 特型内火艇||
|466, 467|翔鶴改二甲, 瑞鶴改二甲|輸送機材, 噴式戦闘機, 噴式戦闘爆撃機, 噴式攻撃機, 噴式偵察機||
|470|霞改二乙|大型電探, 上陸用舟艇, 特型内火艇||
|488|由良改二|水上爆撃機, 特殊潜航艇, 上陸用舟艇, 航空要員, 水上戦闘機, 特型内火艇||
|491|Commandant Teste|ソナー, オートジャイロ, 航空要員, 大型探照灯, 輸送機材|爆雷, 特殊潜航艇, 上陸用舟艇, 特型内火艇|
|496|Zara due|水上爆撃機, 航空要員, 大型探照灯, 水上戦闘機||
|500|神威改母|副砲, ソナー, 爆雷, 上陸用舟艇, 追加装甲(中型), 探照灯, 照明弾, 司令部施設, 対地装備, 水上艦要員, 大型ソナー, 大型飛行艇, 特型内火艇, 輸送機材||
|521|春日丸||艦上攻撃機, 艦上偵察機, 大型電探, オートジャイロ, 対潜哨戒機, 司令部施設, 大型ソナー|
|526|大鷹||艦上偵察機, オートジャイロ, 対潜哨戒機, 大型ソナー|
|529|大鷹改二|ソナー, 爆雷||
|530|伊504|対空機銃, 簡易輸送部材, 輸送機材||
|541|長門改二|小口径主砲, 上陸用舟艇, 大口径主砲(II), 水上戦闘機, 特型内火艇||
|539|UIT-25|対空機銃, 簡易輸送部材, 輸送機材|特殊潜航艇|
|605|Luigi Torelli改|簡易輸送部材, 輸送機材|特殊潜航艇|

(艦船IDが特殊装備リストに含まれていた場合は*マスターデータの内容にかかわらず*装備可能・不可能にする、というコードになっている)  
つまりある意味では不正な装備ともいえる(?)  
~~そのために新艦種を追加するのも面倒なのは分かるが、ちょっとこれはひどい気がする~~  

判定自体については `RemodelMain.swf/scene/remodel/view/changeEquip/EquipList.as` を参照すること。

#### 補強スロットの装備判定

補強スロットに装備可能な装備は、以下に該当する中で **通常スロットにも装備可能であるもの** (and をとったもの) である。  
2017/05/27 現在のデータを以下に示す。

* `api_start2.api_mst_equip_exslot` で指定されているカテゴリの装備
    * 16: 追加装甲
    * 21: 対空機銃
    * 23: 応急修理要員
    * 27: 追加装甲(中型)
    * 28: 追加装甲(大型)
    * 43: 戦闘糧食
    * 44: 補給物資
* 33: 改良型艦本式タービン
* `api_start2.api_mst_equip_exslot_ship` で指定されている装備 (該当艦のみ)
    * 66: 8cm高角砲
    * 220: 8cm高角砲改+増設機銃
        * 阿賀野(改), 能代(改), 矢矧(改), 酒匂(改), 香取(改), 明石(改), 大鯨, 鹿島(改), 由良改二, 鈴谷(航)改二, 熊野(航)改二

なお、見張員判定は補強スロットも参照するようになっている(2015/08/18現在装備することはできない)。

#### 特殊な装備判定(`SLOTITEM_SPECIAL_FLAGS`)  
 
以下に示す一部の装備は、 `api_start2` (マスターデータ) の装備カテゴリと、実際の装備カテゴリが異なる。  
これらは、「改修画面等のカテゴリ表示ではマスターデータに従うが、実際に装備できるか・ソート順は別判定」という不思議な挙動を示す。  

|装備ID(装備名)|APIのカテゴリ|実際のカテゴリ|
|:--|:--|:--|
|128(試製51cm連装砲)|3(大口径主砲)|38(大口径主砲(II))|
|142(15m二重測距儀＋21号電探改二)|13(大型電探)|93(大型電探(II))|
|151(試製景雲(艦偵型))|9(艦上偵察機)|94(艦上偵察機(II))|

これは、艦これの装備システムが「装備可能な装備カテゴリリストの作成 → それに応じて `unsetslot` から装備を抽出」の順で処理を行うため、マスターデータの装備カテゴリではなく `unsetslot` においてどのカテゴリにあるかで判定するためである。  

`unsetslot` ( `api_get_member/unsetslot` 及びそれと同じフォーマットを持つデータ群 )は、誰も装備していない装備のIDをカテゴリ別にリスト化したものである。  
このリスト化は、**マスターデータの装備カテゴリには依存しない**。サーバ側で独自に決定される。  
そのため、上記の装備群はマスターデータの指定とは異なる装備種の扱いを受ける。  

ここで、廃棄処理においてクライアント側で「装備データの削除 → `unsetslot` に装備IDがあればそれも削除」という処理を行っているのだが、マスターデータのカテゴリと `unsetslot` のカテゴリが異なるために、どの `unsetslot` に属しているかが判らないという問題が発生する。 
これを解決するために、Flash 内部に `SLOTITEM_SPECIAL_FLAGS` という 装備IDをキー・置換後装備カテゴリを値とするオブジェクトが存在する。クライアントはこれを利用して削除処理を行う。  

しかしさらに問題なのが、 `SLOTITEM_SPECIAL_FLAGS` と実際のカテゴリ分けに齟齬がある、という点である。  
`SLOTITEM_SPECIAL_FLAGS` の 2015/11/25 時点での設定値を以下に示す。  

|装備ID|置換カテゴリ|
|--:|--:|
|128|38|
|142|43|

先程示した表と照らし合わせて見ると、142(15m二重測距儀＋21号電探改二)はカテゴリ間違い、151(試製景雲(艦偵型))に至ってはそもそも値が存在しないことが分かる。  
(ちなみに 142 の間違いは、実装当初は大型電探(II)のIDが 43 だったのが 2015/08/10 アップデートで 93 に変更されたことに起因する。)   
その結果、この2つの装備を廃棄すると「装備の削除には成功するが `unsetslot` からの削除に失敗する」状態となり、クライアントがクラッシュする(猫る)。  
廃棄API自体は正常に成功するため、再ログイン時に当該装備は削除された状態となる。  

 * [実際に廃棄した様子](https://twitter.com/uma_meshi/status/640180238954033156/photo/1)  
 * [装備は削除される](https://twitter.com/uma_meshi/status/640181133259333632)  

なお、図鑑での表示では、図鑑APIに装備カテゴリが含まれており、そちらを参照して表示を行う(こちらの値は `unsetslot` のカテゴリ分けと同じになっている)。  
そのため、上記のような表示のずれは発生しない。  

> ~~なお、2016/02/24 オンメンテで実装された 164: Ro.44水上戦闘機 は、図鑑での表示カテゴリが他の水上爆撃機とは異なるが、実際のカテゴリ設定は他と同じ ID: 11 (水上爆撃機) である。~~  
> ~~これについては図鑑UI上で決め打ちされており、カテゴリID: 150 (多用途水上機/水上爆撃機/水上戦闘機)として扱われている。~~  
> 現在は「水上戦闘機」カテゴリに移動したため、この処理はなくなった。

#### 主要な任務一覧  

繰り返し出現する任務の一覧を以下に示す。

|任務ID|種別|任務名|達成条件|備考|
|--:|:-:|:--|:--|:--|
|201|日|敵艦隊を撃破せよ！|勝利1
|216|日|敵艦隊主力を撃滅せよ！|戦闘1|ボス戦闘での敗北はカウントに含まない
|210|日|敵艦隊を10回邀撃せよ！|戦闘10
|211|変|敵空母を3隻撃沈せよ！|空母3|日付の1の位が 3,7,0 の場合出現, デイリー扱い
|212|変|敵輸送船団を叩け！|輸送5|日付の1の位が 2,8 の場合出現, デイリー扱い, 218:『敵補給艦を3隻撃沈せよ！』とカウンタが干渉
|218|日|敵補給艦を3隻撃沈せよ！|輸送3|212:『敵輸送船団を叩け！』とカウンタが干渉
|226|日|南西諸島海域の制海権を握れ！|2-(1~5)ボス勝利5
|230|日|敵潜水艦を制圧せよ！|潜水6
|213|週|海上通商破壊作戦|輸送20
|214|週|あ号作戦|出撃36/S勝利6/ボス24/ボス勝利12
|220|週|い号作戦|空母20
|221|週|ろ号作戦|輸送50
|228|週|海上護衛戦|潜水15
|229|週|敵東方艦隊を撃滅せよ！|4-(1~5)ボス勝利12
|242|週|敵東方中枢艦隊を撃破せよ！|4-4ボス勝利1
|243|週|南方海域珊瑚諸島沖の制空権を握れ！|5-2ボスS勝利2
|261|週|海上輸送路の安全確保に努めよ！|1-5ボスA勝利3
|241|週|敵北方艦隊主力を撃滅せよ！|3-(3~5)ボス勝利5
|256|月|「潜水艦隊」出撃せよ！|6-1ボスS勝利3
|257|月|「水雷戦隊」南西へ！|1-4ボスS勝利1|要軽巡旗艦、軽巡3隻まで、他駆逐艦　他艦種禁止
|249|月|「第五戦隊」出撃せよ！|2-5ボスS勝利1|要「那智」「妙高」「羽黒」
|259|月|「水上打撃部隊」南方へ！|5-1ボスS勝利1|要(大和型or長門型or伊勢型or扶桑型)3/軽巡1　巡戦禁止、戦艦追加禁止
|265|月|海上護衛強化月間|1-5ボスA勝利10
|264|月|「空母機動部隊」西へ！|4-2ボスS勝利1|要(空母or軽母or装母)2/駆逐2
|266|月|「水上反撃部隊」突入せよ！|2-5ボスS勝利1|要駆逐旗艦、重巡1軽巡1駆逐4
|822|季|沖ノ島海域迎撃戦|2-4ボスS勝利2
|854|季|戦果拡張任務！「Z作戦」前段作戦|2-4・6-1・6-3ボスA勝利各1/6-4ボスS勝利1
|861|季|強行輸送艦隊、抜錨！|1-6終点到達2|要(航空戦艦or補給艦)2
|862|季|前線の航空偵察を実施せよ！|6-3ボスA勝利2|要水母1軽巡2
|303|日|「演習」で練度向上！|演習3
|304|日|「演習」で他提督を圧倒せよ！|演習勝利5
|302|週|大規模演習|演習勝利20
|311|月|精鋭艦隊演習|演習勝利7|デイリー扱い
|402|日|「遠征」を3回成功させよう！|遠征成功3
|403|日|「遠征」を10回成功させよう！|遠征成功10
|404|週|大規模遠征作戦、発令！|遠征成功30
|410|週|南方への輸送作戦を成功させよ！|「東京急行」「東京急行(弐)」成功1
|411|週|南方への鼠輸送を継続実施せよ！|「東京急行」「東京急行(弐)」成功6|410:『南方への輸送作戦を成功させよ！』の進捗を引き継ぐ(1/7から始まる)
|424|月|輸送船団護衛を強化せよ！|「海上護衛任務」成功4|進捗は1/5から始まる(3回成功時点で80%達成になる)
|426|季|海上通商航路の警戒を厳とせよ！|「警備任務」「対潜警戒任務」「海上護衛任務」「強行偵察任務」成功各1|3エリア達成時点で80%
|428|季|近海に侵入する敵潜を制圧せよ！|「対潜警戒任務」「海峡警備行動」「長時間対潜警戒」成功各2|1エリア達成ごとに進捗が進む
|503|日|艦隊大整備！|入渠5
|504|日|艦隊酒保祭り！|補給15回
|605|日|新装備「開発」指令|開発1(失敗可)
|606|日|新造艦「建造」指令|建造1
|607|日|装備「開発」集中強化！|開発3(失敗可)|605:『新装備「開発」指令』の進捗を引き継ぐ(1/4から始まる)
|608|日|艦娘「建造」艦隊強化！|建造3|606:『新造艦「建造」指令』の進捗を引き継ぐ(1/4から始まる)
|609|日|軍縮条約対応！|解体2
|619|日|装備の改修強化|装備改修1(失敗可)
|613|週|資源の再利用|廃棄24回
|638|週|対空機銃量産|機銃廃棄6個|回ではない
|626|月|精鋭「艦戦」隊の新編成|熟練搭乗員+零式艦戦21型》装備の鳳翔旗艦+零式艦戦21型x2・九六式艦戦x1廃棄
|628|月|機種転換|零式艦戦21型(熟練)>>装備の空母旗艦+零式艦戦52型x2廃棄
|645|月|「洋上補給」物資の調達|三式弾廃棄+(燃料750+弾薬750+ドラム缶(輸送用)x2+九一式徹甲弾)保有
|637|季|「熟練搭乗員」養成|九六式艦戦>>★10装備の鳳翔旗艦+勲章2
|643|季|主力「陸攻」の調達|零式艦戦21型x2廃棄+(九六式陸攻x1+九七式艦攻x2)保有
|663|季|新型艤装の継続研究|大口径主砲x10廃棄+鋼材18000保有
|702|日|艦の「近代化改修」を実施せよ！|近代化改修成功2
|703|週|「近代化改修」を進め、戦備を整えよ！|近代化改修成功15

#### 任務の特殊仕様について

* デイリー開発・建造任務はカウンタが共用。2回目の操作(3回任務の1回目)を行った時点で50%になる
* 東京急行遠征任務も共用。7回とあるが6回でok
* 「輸送船団護衛を強化せよ！」は内部処理的に進捗が 1/5 から始まる
    * 3回達成時点で "80%以上達成" になるため
* 輸送船5隻の変則デイリーと輸送船3隻のデイリーはカウンタが干渉。1隻撃沈で2増える
    * 場合によっては3隻撃沈のほうが「80%以上達成」になることがある（2/3=50%, 3/3は達成となるため本来発生しえない）
* あ号作戦の「出撃」は文字通りであり、戦闘を行う必要はない(ex. 6-1で戦艦2を含めて即帰投しても増える)
* 精鋭艦隊演習はマンスリーだが、デイリー(翌朝5:00)で進捗がリセットされる。
* クォータリー任務の範囲は 3-5, 6-8, 9-11, 12-2 (月)
* 機種転換系任務において「機種転換」「部隊編成」でメッセージが異なったり、「熟練搭乗員」を要求する場合があるが、これらの処理はクライアント側で判定される。  
    `Core.swf/core/consts/DutyConst` を参照せよ。
* 216: 「敵艦隊主力を撃滅せよ！」において、 2-2 ボス直行ルートにて敗北した場合に達成にならない現象が確認されている。  
    そのため、実際の達成条件は「通常戦闘1回もしくはボス勝利1回」であると思われる。
* 854: 『戦果拡張任務！「Z作戦」前段作戦』では、4つ中3つクリアすると "80%以上" になる。
* 428: 「近海に侵入する敵潜を制圧せよ！」は、1つのエリアで2回遠征を成功させるごとに進捗が 50% → 80% → 達成 となる。  
    例えば、「対潜警戒任務」2回時点では 50% となるが、「対潜警戒任務」「海峡警備行動」各1回時点では 0% となる。

##### クライアント側で達成判定がなされる任務

* 641: 「航空基地設営」事前準備
* 642: 「陸攻」隊の増勢
* 643: 主力「陸攻」の調達
* 644: 「一式陸攻」性能向上型の調達
* 645: 「洋上補給」物資の調達
* 646: 「特注家具」の調達
* 647: 中部海域「基地航空隊」展開！
* 648: 「特注家具」の調達
* 649: 新機軸偵察機の開発
* 650: 噴式戦闘爆撃機の開発
* 651: ネ式エンジンの増産
* 652: 「特注家具」の調達
* 653: 節分特別任務：節分準備！
* 654: 【丙】作戦「彩雲」調達＆輸送分解
* 655: 「彩雲」輸送分解
* 657: 春の準備任務：桃の節句準備！
* 658: 潜水艦武装の強化
* 666: 精鋭「瑞雲」隊の編成
* 668: 新型戦闘糧食の試作

以上の任務には、このような特性が存在する。

* すべて「～を廃棄、～を保有(達成時消滅)」という達成条件である
* 達成していたとしても `api_state` が 2 (遂行中) のままである  
* 廃棄を完了していた場合、 `api_progress_flag` が 1 (50%以上達成) ないし 2 (80%以上達成) になることがある
    * 蔵側には異なる進捗率が表示されることがある

これは、装備の保有判定を蔵側で行っており、それによって達成/遂行中を切り替えているためである。  
`DutyMain.swf/scene/duty/models/DutyData` に判定が記載されている。  

#### EnemySlotItemImage

`Consts`に存在する、敵艦装備グラフィックの置換処理らしきもの。  

敵艦装備のグラフィックはカットイン発動時に確認することができるが、特に指定のない場合 `EquipmentID-500` 、すなわちIDインデックスの同じ味方側装備が表示される。  
(ex. 507: 14inch連装砲 = 7 : 35.6cm連装砲)  

> おそらくこの仕様を利用するため、初期の敵側の装備は艦娘の装備と一対一対応するようになっている (ID: 541 まで) 。  
> そのためか、この領域内には未使用の装備が存在する。

しかし、以下の装備は特定の装備グラフィックを持つよう指定されている。

|装備ID|装備名|置換装備ID|置換装備名|
|--:|:--|--:|:--|
|550|5inch連装両用莢砲|3|10cm連装高角砲|
|551|20inch連装砲|128|試製51cm連装砲|
|552|15inch要塞砲|76|38cm連装砲|
|553|4inch連装両用砲+CIC|3|10cm連装高角砲|
|563|8inch長射程連装砲|162|203mm/53 連装砲|
|565|5inch沿岸設置砲|78|12.7cm単装砲|
|567|沿岸設置レーダー|13|61cm三連装魚雷|
|576|深海12inch三連装砲|231|30.5cm三連装砲|
|577|深海15inch四連装砲|245|38cm四連装砲|
|578|深海15inch連装砲後期型|190|38.1cm Mk.I連装砲|

> 567(沿岸設置レーダー)については、31(32号対水上電探)だったはずが typo したものと考えられる。

~~なお、2015/05/30現在これらを装備している艦はカットイン攻撃を行わないため、実際に確認することはできない。~~  
2016/02/10('16 冬イベアップデート)で実装された「重巡棲姫」が、「8inch長射程連装砲」を用いたカットイン攻撃を行ってくるため、ようやく確認できた。  

またこれとは関係は薄いが、ID:515「高速深海魚雷」のカットイン文字が「22inch魚雷後期型」となる現象が確認されている。  
これはID:514「21inch魚雷後期型」とは異なるため、当初の命名はこちらだったのかもしれない。  

#### オンメンテで実装された艦娘の扱い

オンメンテ前のテーブルで確保してある「なし」領域を埋めるように実装される。  
そのため、メンテ前の情報を保持した蔵が新規実装艦を持つ艦隊と演習しても落ちることはない。  

但しその際、当然ながら(表示上の)パラメータ及び処理は「なし」のデータに基づくため、以下のような現象が発生する。  

* 艦種は駆逐艦、艦名は「なし」
* グラフィック自体は新規艦のものが表示される
* 演習開始時のカットインでグラフィックが左上に大きくずれる
* 速力が0のため(もちろん表示上のみだが)陸上基地扱い。当然バナーも「混乱」「損壊」といった表示になる

当然ではあるが、戦闘自体はサーバ側の演算によるので全く問題はない(潜水艦が駆逐艦扱いになって砲撃する、などといったことはない)。

具体的な「なし」のパラメータについては以下のとおりである。ほぼ0で埋められている。

|パラメータ|値|
|:--|:--|
|図鑑番号|0|
|艦名|"なし"|
|読み|"なし"|
|艦種|駆逐艦|
|改装|不可|
|耐久|0(戦闘時に与えられる)|
|各種パラメータ|0|
|速力|0(陸上基地)|
|射程|無|
|レア|0|
|スロット数|0|
|搭載機数|全て0|
|建造時間|0|
|解体資源|0/0/0/0|
|近代化改修増加値|0/0/0/0|
|ドロップ文章|*(なし)*|
|搭載燃料/弾薬|0/0|
|ボイスフラグ|0|
|リソース名|(一意の文字列)|

また、新規実装ボイスを持つ艦は、母港については再読み込みしなくても新しいボイスが再生される。  
但し時報・放置ボイスまで適用されるかは未確認。データ上は未実装扱いのはずなので再生されない？  

#### 連合艦隊経験値バグ

'15 春イベで確認。  
戦闘結果で表示された入手経験値と実際に入手した経験値が食い違うバグ。  
連合艦隊戦で退避艦が存在するときに発生する。  

具体的には、第一艦隊・第二艦隊ともに退避艦があるときに  

* 第一艦隊六番艦に旗艦MVP相当の経験値  
* 第二艦隊MVP艦の経験値が非MVP艦と変わらない
* 第二艦隊五番艦・六番艦は経験値0(もちろん退避はしていない)

といった現象が発生したりする。(あくまで一例であり、状況によって異なる。)  
なお、戦闘結果画面は通常どおり(本来の仕様通り)表示される。この表示と実際の取得経験値が異なるのが問題である。  

これが発生すると、入手経験値が「増える」「減る」「0になる」の3通りの現象が発生する。  
このバグで余分に入った経験値でnext. が0以下になってもレベルアップしない。(処理が行われないらしく、next. が負値になったままの状態になる。次の戦闘でレベルアップ処理が行われる。)  
こちらは未確認だが、同様に「必要経験値未満でもレベルアップする」現象が発生するかもしれない。

以下は推測であるが、「退避艦を除外した上で計算している」のが原因であると思われる。  
例えば、以下のような取得経験値となったとする。@ はMVPである。

|第一艦隊|第二艦隊|
|--:|--:|
|1200 @|600|
|400|400|
|400|0(退避)|
|0(退避)|400|
|400|800 @|
|400|400|

本来ならばこのように処理されるべきであるが、どうやら退避艦をこのリストからスキップして詰めるらしく、以下のように処理される：

|第一艦隊|第二艦隊|
|--:|--:|
|1200 @|400|
|400|400|
|400|800|
|400|400|
|400|0 @|
|600|0|

退避艦をスキップしたため空いた2-5, 2-6は0で埋められる。  
そのうえで退避艦処理をさらに行うため、

|第一艦隊|第二艦隊|
|--:|--:|
|1200 @|*400*|
|400|400|
|400|0(退避)|
|0(退避)|400|
|400|*0 @*|
|*600*|*0*|

となる。結果として、*斜体で示した艦*の経験値がずれる。  

第二艦隊のみに退避艦がいた場合、第一艦隊は通常通りで第二艦隊の退避艦以降の艦の経験値のみがずれ込むので、多分このような処理になっていると思う。  

この不具合があるため、第二艦隊五番艦と六番艦は退避発動中は経験値を得ることができない。4隻以上退避した場合は未確認であるが、同様に経験値の不審な増減が発生するものと思われる。    
育成においては注意が必要である。  

なお、連合艦隊でなくても轟沈艦が存在した場合に同様の現象が起こる、との噂がある。  

**このバグは '15 夏イベで修正された模様。** ログを確認したが上に述べた現象は発生していなかった。

#### 演習経験値バグ

演習で撃沈判定を受けた艦娘の経験値が減少するバグ。

上記経験値バグの検証の一環で、演習で撃沈判定を発生させて実験してみたところ、上に挙げたような経験値のずれは確認されなかった。  
しかし、撃沈判定を受けた艦の累積取得経験値が -1 されるという現象が発生した(戦闘結果での表示上は `+ 0 exp`)。  
確かに戦闘結果のAPIの取得経験値の項目は -1 になっていたが、直接適用されたのは予想外。  

Lv. 99の艦を以上の状態におき経験値を -1 させたところ、 Lv. 99 / 999999 exp. / next. 0 になった。  
この状態で別の戦闘を行ったところ、戦闘結果では「次のレベルまで」に何も表示されなかった(通常のLv99と同じ扱い)が、実経験値は 1000000 exp.に戻っていた。  
exp を -1 した状態でもケッコンカッコカリを行うことができる。この場合は、 Lv. 100 / 999999 exp. / next. 10001 となった。  
また、Lv. 1 / 0 exp. / next. 100 の状態でこの現象を発生させたところ、 Lv. 1 / -1 exp. / next. 101 となった。

> 注: 経験値0の大破艦は、単艦で5-5に出撃した後戦闘結果を見る前に再読み込みするとほぼ確実に入手することができる。

以上をまとめるとこのようになる。

* 演習で撃沈判定を受けると累積経験値が -1 される
* これによってレベルが下がる・レベルが上げられなくなる・ケッコンできなくなるといったことはない
* 減少した経験値はLv99でも(おそらくLv150でも)上限まで再入手できる
* Lv99で減少した経験値はケッコン後も引き継がれる(100万に補正されない) 
* 累積経験値は負値にすることができる

これによって何らかの不具合が出るかは未確認。  
経験値計算に艦の累積経験値を利用しているらしい演習において、経験値が負値の艦隊と演習したらどうなるのだろうか…

#### MVPの優先度

与ダメージによって判定される。  
与ダメージが同じ艦が存在する場合は、ランダムであると推測している。  
与ダメージが同じ場合の判定では、少なくとも、

* 先に攻撃したほう
* 後から攻撃したほう
* 旗艦に近いほう
* 6番艦に近いほう
* 第一砲撃戦で先に攻撃したほう
* 〃後に攻撃したほう
* 旗艦 > 6番艦 > 5番艦 > …

については反例が存在する。  
以下に調査時のデータを示す。  

```
航空戦無視(与ダメトップに関与しない艦)
北上 #1   開幕雷撃
長門 #3   砲撃
これらの艦に他の与ダメージ無
実際のMVP　北上

こちら潜水艦隊　航空戦無
先制雷撃
#2 153dmg / #4 150dmg
雷撃
#2 43dmg / #4 46dmg
実際のMVP #4

同じく潜水艦隊
開幕雷撃
#4 46dmg / #5 37dmg
雷撃
#4 32dmg / #5 41dmg
実際のMVP #5

同じく
開幕雷撃
#2 84dmg / #3 94dmg
雷撃
#2 82dmg / #3 72dmg
実際のMVP #3

演習
航空戦　自軍与ダメージ0
砲撃1
#3 62dmg #2 91dmg
砲撃2
#2 103dmg #3 132dmg
ともに雷撃0ダメージ
夜戦
ともに行動せず
MVP #2

同じく演習
航空戦関与せず
砲撃1
#3 122dmg, #4 123dmg
砲撃2
#3 105dmg, #4 104dmg
雷撃/夜戦無
MVP #4

1-1 キラ付け編成
砲撃1
#2 14dmg, #3 14dmg
MVP #3

潜水艦隊
開幕雷撃
#1 95dmg, #3 108dmg
雷撃
#1 108dmg, #3 95dmg
MVP #1

1-1 キラ付け編成
砲撃1
#3 13dmg, #2 13dmg
MVP #3
```

また、MVPになる条件として「与ダメージが1以上」が存在する。D敗北以上の判定で条件を満たす艦が1隻も存在しない場合(全員の与ダメージが0の場合)、後続条件にかかわらず旗艦がMVPとなる。

#### 突然の入渠API

2015/05/28(暁改二アップデート前日)、シーンにかかわらず(図鑑や出撃・戦闘中ですら)突然入渠APIが呼び出される現象が発生した。  
タイミングとしては「入渠中の艦の待ち時間が00:00:00になった瞬間」である。[画面下部の通信プログレスバー(?)が表示されたため](https://twitter.com/andanteyk/status/603934695819083777/photo/1)、正規クライアントによる通信であることは明らかである。  
起動直後は発生せず、しばらく経過すると発生していた。特定の操作をトリガーにしていた可能性がある。  
なお、その際「2回連続でndockリクエストを送る」現象も確認されている。例えば、

```
battle.request
battle.response
ndock.request
ndock.request
ndock.response
ndock.response
battleresult.request
battleresult.response
```

といった通信が行われていたことを確認している。  
時間経過とともに通信回数が増える(最初は0回(発生しない)→1回→2回(上記))。  
このような冗長な通信を正規に行うとは考えにくいため、クライアントに何らかの不具合が発生しているものと推察される。  
通信中はUI操作がブロックされるため、地味に厄介。  

[twitter](https://twitter.com/RizaSTAR/status/601763671119831041)にて、5/22時点ですでに発生していたらしき報告有。

#### next 非表示バグ
Lv148→149にレベルアップした時に、戦闘結果画面の next. がLv99・Lv150の時のように空欄になるバグ。  
サーバーからnext. のデータが送られてこないために発生する。  
この現象が発生するのはレベルアップ時のみで、以降は通常通り表示される。  

2015/12/08 アップデートによりLv上限が155になったが、その影響で上記問題の発生が Lv153→154 の時に変更された。  
不具合自体は修正されなかったらしい。  

#### 応急修理要員の画像が読み込めない問題
2015/07/29現在、応急修理要員の`item_up`及び`item_character`の画像にアクセスできなくなっている。(`404 Not found` とのこと)  
画像をうっかり消してしまったのだろうか？  
wiki曰く、同年5月ごろには既にこの問題が確認されていた模様。  

 * 2014/02/03 の書き込みにもそれらしき報告がある。

#### 装備図鑑でクリックできないバグ
図鑑を開いてすぐに「装備図鑑(2)」を開くと、「彗星一二型甲」のページが開けなくなるバグ。  
別のページを経由すればクリックできるようになる。発生原因は不明。  
2015/10/09 アップデートにより、ページが変更になったためか発生しなくなった。

#### 艦載機熟練度のデフォルト値
(熟練)及び(○○隊)はLv.2、(○○空)はLv.1になる。

#### 離島棲鬼 Lv. 3
'15 夏イベント E-7-Y の離島棲鬼のレベルは通常1であるが、時々3になることがある。  
装備やその他のパラメータ、編成に変化は見られなかった。  
難易度丙・甲ともに確認されている。乙では未確認であるが、出現していた可能性は高い。  
[丙作戦で5回中5回すべてが Lv. 3 だったという報告](https://twitter.com/KancolleSniffer/status/637656603823579137)もある。  

後日調査を行った。以下に交戦記録を示す。

|状況|Lv.|
|--:|:--|
|丙 #1|3|
|#2|1|
|#3|1|
|翌日 甲 #1|1|
|#2|1|
|#3|1|
|後日 甲 #1|3|
|#2|3|
|#3|1|
|#4|1|
|#5|1|
|翌日 #6|3|
|#7|1|
|#8|3|
|#9|3|
|#10|3|
|#11|3|
|#12|3|
|#13|3|
|#14|3|
|#15|1|

また、装甲破壊システムに関与しているとされている X セルの港湾棲鬼及び K セルの空母ヲ級についてはこのような現象は見られなかった(常にLv. 1)。  
イベントの装甲破壊システムとの関係性は不明。  
彼女の装備的に公式クライアントからレベルを確認することはできない(砲を装備していないため攻撃時にカットインが出ない)ため、プレイヤーに気づかせる気はないものと考えられる。  

以下は仮説であり、十分な検証が行われたものではない事を注記しておく。  
Lv. 3 の離島棲鬼には装甲破壊効果はないのではないかと思われる。  
理由としては、Lv. 1の離島棲鬼を破壊することで十分に装甲破壊効果が得られているためである。初回攻略時(上表 甲#1～#3 破壊後)において、敵旗艦装甲 333 ではありえないダメージを観測している。  
また、「 X, Y セルをそれぞれ3回破壊で十分な効果が得られる」というのが通説であったが、効果が実感できなかったとの報告もよく見られた。（編成に問題があったのかもしれないが…）  
上記調査においてはその出現はランダムであるように見えるため、効果のないほうを連続で引いてしまったのではないか、と推測する。  

ただ、上記報告において「全てLv. 3だった」場合においても攻略できていることを考えると、この仮説の正確性はかなり怪しい。単純に設定ミスであり、「レベルが違う」以外に意味はないという可能性も大きい。  

また、同イベント E-7-I において出現する潜水艦隊には「潜水カ級 elite」が2隻編成されているが、5番艦は Lv. 50 で6番艦は Lv. 1 であった。  
通常海域に出現するものはおそらく Lv. 50 のみである。こちらの関連も不明。


#### 異なるレベルを持つ敵艦

以下の敵艦は通常のものとは異なるレベルを持つ。

|敵艦|通常レベル|設定レベル|出現位置|位置備考|編成備考|
|:--|--:|--:|:--|:--|:--|
|潜水カ級|50|0|5-1-3|初手渦潮の次の潜水艦マス|5隻編成の潜水艦隊の5番艦|


#### 総合力の計算式

出撃直前に表示される「総合力」(レーダーチャートに表示されるもの)の計算式を以下に示す。

```
(艦船数≧1の場合)
表示値 = round( パラメータ / 艦船数 ) + round( round( パラメータ / 艦船数 ) * sqrt( 艦船数 - 1 ) )

(艦船数=0の場合)
表示値 = 0

パラメータ = 各艦のパラメータ合計(装備込)
```

なお、レーダーチャート上での最大値は 350 である。  
(数値はそれ以上に上げられるが、レーダーチャートの大きさはそれ以上にはならない)  

#### 戦闘糧食と秋刀魚の缶詰

*※注記：コードを流し読みしたものであり、検証中である。*  
両方持っている状態で発動した時、必ずどちらも発動する。(どちらか1つだけ発動することはない)。  
大本営曰く併用でより効果が上がるようだが、未検証。

#### 改装時に必要な特殊資材

##### 開発資材

基本的には、改装に必要な鋼材の量に依存する。

```
if ( ( Saratoga Mk.II | Saratoga Mk.II Mod.2 ) からの改装である )
    return 20; 
else if ( 改装設計図が必要 && ( 鈴谷改二 | 鈴谷航改二 | 熊野改二 | 熊野航改二 ) からの改装ではない )
    return 0;
else if ( 鋼材 < 4500 ) return 0;
else if ( 鋼材 < 5500 ) return 10;
else if ( 鋼材 < 6500 ) return 15;
else return 20;
```

##### 高速建造材

ソースコード中に決め打ちされている。  

```
if ( ( 鈴谷改二 | 鈴谷航改二 | 熊野改二 | 熊野航改二 ) からの改装である )
    return 20;
else if ( ( Saratoga Mk.II | Saratoga Mk.II Mod.2 ) からの改装である )
    return 30;
else
    return 0;
```

#### 編成登録・展開の挙動

* 展開時に以下の状態である艦娘はスキップされる。全員がその状態の場合は展開できない。
    * 別の艦隊に所属している。
    * 除籍されている。
* 除籍された艦娘のIDはリストに残る（展開時には `×　除籍艦` と表示される）。但し、当該編成を展開した際にリストから削除される。
* 全員が除籍されたリストは自動的に削除される。
* 空いたスロットがあっても詰められることはない。(#2 のスロットが削除されても #3 は移動しない)

#### リソースIDについて
艦娘のグラフィックファイル名(リソースID)だが、秋刀魚祭りアップデート以降、グラフィック変更でもリソースIDが変更になることがある。  
( ex. Libeccio(ハロウィン仕様)の際、`nsutzbtifaji` -> `nsutzbtifami` )  
一部だけが書き換わっているところを見ると、単純なハッシュ値ではないのかもしれない。  

2015/12/08 アップデート(秋イベ終了)時のグラフィック更新(クリスマスシリーズ)では、上に述べたような変化は発生しなかった(ハロウィン仕様の艦のリソースIDは元に戻った)。

2016/01/01(新年晴れ着)アップデートにおいては、 `tuvoqtqrddem` -> `zzztuvoqtqrd` になるような変更が行われており、一貫性がない。

どうやらオンメンテによるグラフィック更新時に描画が崩れるのを防ぐ (描画座標は `api_start2` に入っているため、再読み込みせずに画像だけ更新されると表示位置がずれる) ためにこうなっているらしく、オンメンテ時のみ変更されうるようだ。

> リソースIDに使われている各文字の出現頻度を調べたところ、 a と z は他の文字に比べて出現率が半分であった。
> この文字列を求める計算式に何かしらの偏りがあるのかもしれない。

#### 揚陸地点について
揚陸時点で大破・退避していた場合、減少TP計算に含まれない。  
また、減少TP計算には揚陸地点に到達した時点での状況が使われる。  
揚陸地点通過後に大破・退避・沈没した、揚陸地点通過時に大破→ボス戦で女神復活した、ボス戦で戦闘糧食を食べたなどしても、減少TPは変わらない。  

#### 装甲破壊された敵艦のグラフィック
画像は `[リソースID]_d.swf` になる。  
装甲破壊されたかの判定は戦闘APIの ~~`api_boss_damaged`~~ `api_xal01` の参照で行う。  
また、ボイスは末尾が 0 から 1 になる( 例: `32464410` → `32464411` )。  
なお、2015/11/25 現在、上記フラグは通常艦隊・機動部隊昼戦時のみ存在し、水上部隊戦や夜戦時には存在しない模様。  

#### 改修リスト表示バグ
2016/02/24 ごろ（'16 冬イベアップデート以降?）から、「他」(艦隊未所属艦)の1ページ目に存在する艦を、第一艦隊所属艦(第二以降でも可?未確認)に近代化改修した後、再び「他」ページを開くと、近代化改修で除籍された艦がなぜかリストに残っており、表示が崩れる不具合がある。  
[選択する前は右側ペインが表示されない状態となり](https://twitter.com/andanteyk/status/700951095015641088)、何かの艦を選択すると[「リスト表示は艦が残ったままだが、選択は通常通り働く」](https://twitter.com/andanteyk/status/700952401201594368)という状態になる。  
（リストの1番目の艦を近代化改修に使用した場合、リストの1番目を選択すると「リストの艦名は使用した艦だが、右側の表示は現存する1番目の艦」といった状態になる。この状態で10番目の艦を選択すると、リスト外の艦を選択できる(ように見える)。）  
別のページを開くか近代化改修ページを開くと正常な状態に戻る。  

#### 彩雲装備時のT字不利
長距離空襲戦では、彩雲を装備していてもT字不利が発生することがある。  
[スクリーンショットはこちらを参照。](https://twitter.com/andanteyk/status/697771799849734144)  
最も、空襲戦では航空攻撃しか行われないため、陣形補正は働かずあまり意味はない。  


#### 洋上補給の複数発動について
2016/04/01 アップデートから(少なくとも04/17時点で)、洋上補給がボス到達時に任意で発動可能になったとともに、同時に複数個発動可能になった。  

回復量を以下に示す。

|消費個数|通常艦隊回復量|連合艦隊回復量|
|:--|--:|--:|
|1|25%|15%|
|2|36%|27.5%|
|3|47%|40%|

ソース:　[https://twitter.com/KennethWWKK/status/839741687240933376](https://twitter.com/KennethWWKK/status/839741687240933376)


#### 基地航空隊関連の挙動

* 熟練度(少なくとも制空値ボーナス)は有効
* 敵偵察機も航空戦に参加する
    * そのため、敵の偵察機搭載数を測定できるかもしれない
* 局地戦闘機は「命中」が「対爆」、「回避」が「迎撃」と表示される
* 補給しなくとも配置転換すれば全機補充される
    * 但し配置コストがかかるので利用は難しい
* `api_start2` において、戦闘行動半径と配置コストが設定されていない場合（非航空機）、項目が存在しない
* 配備時のボーキサイト消費は `コスト * 機数`
* 補給時の消費は `燃料 = 喪失機数 * 3`, `ボーキサイト = 喪失機数 * 5`
* 攻撃フェーズ終了時の損害率表記は以下の通り(上優先)
    * 開始時機数 == 0 : 表示なし
    * 終了時機数 == 0 : 「全滅」
    * 終了時機数 / 開始時機数 < 0.25 : 「被害甚大」
    * 終了時機数 / 開始時機数 < 0.4 : 「未帰還機多数」
    * それ以外 : 表示なし


#### 敵潜水艦の先制雷撃
elite 級か flagship 級であれば先制雷撃を行う。  
味方側と違い、特殊潜航艇の装備有無は関与しない。  


#### 索敵フェーズで飛んでいく偵察機の選択
( カテゴリ = ( 艦上偵察機 | 水上偵察機 | 水上爆撃機 | 大型飛行艇 ) かつ 搭載機数 > 0 ) であるスロットの中で、基準値( = 索敵 + √改修レベル )が最大なものを選択する。  
同値が複数存在した場合、先頭に近いほう( 旗艦第1スロ＞…＞旗艦第5スロ＞2番艦第1スロ＞… )を選択する。  
該当するものが存在しなかった場合 (艦攻のみで索敵成功など) は、デフォルトの 零式水上偵察機 が選択される。


#### 連合艦隊夜戦最大HPバグ
'16 秋イベ時(2016/12/02 現在)、味方側が連合艦隊の夜戦 ( `api_req_combined_battle/midnight_battle`, `api_req_combined_battle/ec_midnight_battle` ) において、味方随伴艦隊の最大HP ( `api_maxhps_combined [1~6]` ) が夜戦突入時の現在HP ( `api_nowhps_combined [1~6]` ) と常に等しくなる不具合が存在する。  
敵随伴艦隊のHP ( `[7~12]` ) は正しく反映されている。  
なぜか本体クライアント側では正常に表示されているが、戦闘解析を行う際は注意が必要。  

2017 夏イベントでは確認できなかったため、修正された模様。

#### クリック時に図鑑虫が飛んでいく確率

1/5 。  
具体的には、`Math.Floor( Math.Random() * 5 ) == 2` となったときに飛んでいく。

放置時の小ジャンプ・ぐりぐり動作や、次の動作までの待ち時間決定で乱数を消費するため、これで調整すれば*理論上は*無限にクリックし続けることができる。

#### 鎮守府カウンターバーについて

艦船の読み(一部例外あり)と現在時刻をベースにして内容が決定されている。  
以下に示す情報は 2017/08/02 時点でのもの。  

艦娘カテゴリは、艦名読み (`api_yomi`) をキーとして下表から決定される。

艦娘カテゴリ|艦名読み
--:|:--
 0|(その他)
 1|ちとせ, きそ, やましろ, きりしま, かもい
 2|ほうしょう, ずいほう, やまと, かが, うんりゅう, ひりゅう, みょうこう, はつはる, あかし, しょうほう, あきつまる, きくづき, あまぎ, いせ, ひゅうが, はつかぜ, みずほ, かみかぜ
 3|なち, あしがら, むつ, はやしも, ガングート
 4|ちくま, きさらぎ, おおよど, たいほう, ゆうぐも, ながなみ, もがみ, いそかぜ, やはぎ
 5|ビスマルク, かとり, い8, むらさめ, たつた
 6|はるな, ひよう, そうりゅう, むらくも
 7|じゅんよう, むさし, かこ, あさしも, い19, い14
 8|むつき, やよい, うづき, ふみづき, あかつき, いかづち, いなづま, あけぼの, おぼろ, あさしお, おおしお, てんりゅう, しらつゆ, はるさめ, あさぐも, やまぐも, まいかぜ, きよしも, まきぐも, ながと, しまかぜ, ゆきかぜ, さかわ, たかなみ, ふぶき, しらゆき, はつゆき, みゆき, いそなみ, あやなみ, しきなみ, リベッチオ, ひびき, みなづき, い26, うらなみ, しむしゅ, くなしり, なか, ルイージ・トレッリ
 9|リットリオ・イタリア, ローマ, ザラ, アクィラ
10|あきづき, かすみ, しぐれ, あかぎ, あぶくま, あきつしま, かつらぎ, てるづき, い401, まるゆ, はやすい, かわかぜ, かざぐも, あらし, はつづき, おやしお, やまかぜ
11|い58, い168, あがの, のしろ, くまの, すずや, あまつかぜ, プリンツ・オイゲン, はぎかぜ, グラーフ・ツェッペリン, ゆー511・ろ500, ずいかく, い13, えとろふ, まつわ
12|ポーラ
13|アイオワ
14|コマンダン・テスト, たいよう, リシュリュー
15|サラトガ, あまぎり
16|はるかぜ, あさかぜ, まつかぜ
17|こんごう, ウォースパイト, アークロイヤル
18|ゆら, きぬ, じんつう, せんだい, おきなみ, ふじなみ, ゆうばり, みくま, たいげい・りゅうほう, きたかみ, おおい, はたかぜ, さぎり

なお、以下に示す艦は例外的に別のカテゴリに所属する。

艦船ID | 艦船名 | 艦娘カテゴリ
--:|:--|--:
147 | Верный | 4
466 | 翔鶴改二甲 | 1
461 | 翔鶴改二 | 2
436 | 呂500 | 6

カテゴリごとの表示される食事は以下の通り。

艦娘カテゴリ|05:00～|19:00～|21:00～|22:00～|25:00～
--:|:--|:--|:--|:--|:--
 0|なし|ビール|ビール|なし|なし
 1|なし|ビール|日本酒|日本酒|日本酒
 2|なし|ビール|日本酒|日本酒|なし
 3|なし|ビール|ウイスキー|ウイスキー|ウイスキー
 4|なし|ビール|ウイスキー|ウイスキー|なし
 5|なし|ビール|ワイン|ワイン|ワイン
 6|なし|ビール|ワイン|ワイン|なし
 7|なし|ビール|日本酒|飲みすぎワイン|ウイスキー
 8|ジュース|ジュース|なし|なし|なし
 9|イタリアワイン|イタリアワイン|イタリアワイン|ワイン|なし
10|なし|戦闘糧食|なし|戦闘糧食|なし
11|なし|ジュース|ワイン|ワイン|なし
12|イタリアワイン|イタリアワイン|飲みすぎワイン|飲みすぎワイン|飲みすぎワイン
13|ハンバーガー|ステーキ|ハンバーガー|ウイスキー|なし
14|フランスワイン|フルコース|フルコース|フランスワイン|フランスワイン
15|ターキーサンド|ステーキ|ステーキ|ウイスキー|飲みすぎワイン
16|ターキーサンド|ビール|戦闘糧食|ワイン|なし
17|ターキーサンド|ビール|ウイスキー|ウイスキー|なし
18|日本茶1|お茶と日本食|日本茶2|なし|なし


#### 表示装備メモ

攻撃時に表示される装備名のカットインは、戦闘APIの `api_si_list` で指定された装備IDをもとに決められる。

ここで指定される装備は以下のとおりである。

* 連続射撃: 砲1, 砲2
* 砲撃: 砲
* 雷撃: 魚雷
* 昼戦カットイン(主砲/主砲): 偵察機, 砲1, 砲2
* 対潜攻撃: 爆雷/水上偵察機/艦上攻撃機/オートジャイロ/対潜哨戒機/etc.
* 夜戦カットイン(主砲/魚雷/電探): 主砲, 魚雷, 電探
* 夜戦カットイン(魚雷/電探/見張員): 魚雷, 電探, 見張員

該当する装備がなければ「表示なし」になる。  
なお、実際に表示されるのは「主砲系」「副砲」「魚雷系」のみであり(後述)、ほかの装備はクライアント側の表示処理でスキップされる。  

なお、それぞれのカテゴリIDは以下のとおりである。

* 主砲系: 1, 2, 3, 38 (小口径主砲, 中口径主砲, 大口径主砲, 大口径主砲(II))
* 副砲系: 4 (副砲)
* 魚雷系: 5, 32 (魚雷, 潜水艦魚雷)

ここで表示される装備は、上記カテゴリを満たす中で、先頭の装備スロットから順番に選ばれる(スロット[0]＞スロット[1]＞…＞スロット[4]＞補強スロット)
。  
例えば、昼戦カットイン(主砲/主砲)の場合、水上偵察機の中で先頭から1番目の装備と、主砲の中で先頭から1番目/2番目の装備が選ばれる。  

表示装備は、夜戦単発攻撃が 砲撃/雷撃 どちらになるかの判定にも使われている。  
表示装備の最初のIDが 主砲系/副砲系 であれば 砲撃, 魚雷系であれば 雷撃 となる。  
どれも装備していないなら 砲撃 になる。  

#### 入渠時に特定の操作をすると猫るバグ

以下の手順を踏むと猫る。

1. ドック A に入渠させる。
2. ドック A に高速修復材を使う。  
    直接高速入渠させてもよい。
3. ドック B に入渠させる。（高速修復材は使わない）  
    この時点でドック A は空き表示になる。
4. ドック A の高速修復によるクレーンアニメーションが消える前に、ドック A に入渠させる。
5. アニメーション終了とともに、ドック A が空き表示になる。
6. ドック A に入渠させる。
7. 猫る。

本来 6. の時点でドック A には入渠艦がいるが、クライアント側では空いているように見えるため、同じドックに重複して入渠させる操作が可能になってしまう。  
これを実行するとサーバ側でチェックが行われ、不正な操作として通信エラーのレスポンスが返るため、猫る。  
なお、エラーコードは 100 である(2017/08/26現在)。  

このバグの発生中( 5. の時点)は、ドック A は空きドックにも関わらずクレーンアニメーションが行われる。  
また、ほかの画面に移動するか、別のドックに入渠させるなどして更新を行うと、消えていた艦が再度表示される。  


#### FPS
艦これは基本的に 30 fps で動作する。（Consts を参照）

但し、マウスカーソルを動かしている間画面更新がより高速に行われることがあり、結果として動作が加速することがある。  
（戦闘勝利画面の紙吹雪など）  


#### 夜戦空母攻撃フラグについて

`api_n_mother_list` が 1 になる条件について、以下のように推測する。

* Ark Royal(改): Swordfish系艦攻 を装備している && 夜間航空要員 を装備している
* Saratoga Mk. II: 夜間戦闘機or夜間攻撃機を装備している
* any(上記艦を含む): 夜間戦闘機or夜間攻撃機を装備している && 夜間航空要員を装備している

夜間攻撃機については、執筆時点で保有していないため完全に推測である。

実験した項目を以下に示す。

```
1:
蒼龍改：流星2/夜戦/要員
Ark Royal改：Swordfish3/要員
Ark Royal改：流星2/夜戦/要員
Saratoga Mk.II：流星3/夜戦

0:
Ark Royal改：Swordfish4
Ark Royal改：Swordfish3/夜戦

そもそも行動せず:
Saratoga Mk.II：流星3/烈風
蒼龍改：流星3/夜戦
蒼龍改：流星3/要員
```


#### 海防艦改修によるパラメータ上昇表示処理

海防艦を近代化改修に使用した際のパラメータ上昇表示（「↑」マーク）は、以下のようにして決定される。  
なお、分かるのは「↑」マークが表示されるかどうかのみで、上昇値は実際に改修しないと分からない。

```
同艦型フラグ = 海防艦であり、艦型(ctype)が同じで、艦名読みが異なる艦娘が含まれている;
// 例：占守＋国後、択捉＋松輪のペアを含む


if( 海防艦数 >= 1 ) {
    運上昇フラグ = true;
    対潜上昇フラグ = true;
}
if( 海防艦数 >= 2 && 同艦型フラグ == true ) {
    耐久上昇フラグ = true;
}
if( ( 運最大値 - 運現在値 ) <= 0 ) {
    運上昇フラグ = false;
}
if( 耐久改修値 >= 2 ) {
    耐久上昇フラグ = false;
}
if( 耐久現在値 >= 耐久最大値 ) {
    耐久上昇フラグ = false;
}
if( 対潜改修値 >= 9 ) {
    対潜上昇フラグ = false;
} else if( 対潜最大値 == 0 ) {
    対潜上昇フラグ = false;
}
```

以上から分かる通り、2017/09/29 現在 改修値には上限が存在する。

* 耐久: 2 (最大値を超えない)
* 対潜: 9 (最大値を超えることはできるが、最大値 == 0 の場合改修不能)

上限値は `vo.UserShipData.VHP` 及び `VAS` で設定されている。



#### ケッコンカッコカリ後の補給について

ケッコンカッコカリ後も搭載燃料・弾薬量自体は変化しない。  
（API での数値はもちろん、渦潮のダメージ等でも確認可能である。）  
補給時に消費資源が `max( floor( 減少量 * 0.85 ), 1 )` に割引される。  


#### 単艦退避について

* 出撃時点で7隻以下の編成ではおそらく発生しない。  
    以下に示すものについては発生しないことが確認済みである：
    * (第一艦隊, 5隻編成, 通常海域)
    * (第三艦隊, 6隻編成, 通常海域)
    * (第一艦隊, 3隻編成, イベント海域)
    * (第三艦隊, 3隻編成, イベント海域)
        * 途中で撃沈された場合にどうなるかは未検証。  
* 1戦闘あたり1隻ずつではあるが、複数艦退避することは可能。
* 退避した時点で HP は減少する。直後の `ship_deck` の時点で HP が減少したデータが送信されてくる。  
    減少量については未調査であるが、「山風改 Lv. 106 HP 6/35 → 1」「那智改二 Lv. 123 HP 14/63 → 4」「あきつ丸改 Lv. 51 HP 10/40 → 1」を確認している。


#### 索敵時の未帰還機について

「索敵成功 - 未帰還機あり」となった場合でも、搭載スロットの機数が減少しない現象が確認されている。  
潜水空母の1機スロットに水上爆撃機を搭載している状況で確認。  
直後の航空戦フェーズにも通常通り参加する。  
確実に起こるわけではなく、減少することもある。  

加えて、索敵フェーズで艦載機が全滅した場合、（少なくとも見た目上は）当該機の熟練度は下がらないようである。  
全滅後に補給し 1-1 に出撃・戦闘・帰投後も同じレベルを維持していた。  




