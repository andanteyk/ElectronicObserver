## 艦これの仕様に関する雑多なメモ
---

#### 特注家具職人が必要な条件  
2000≦price<20000  
とくに特別なフラグはない。  

#### ケッコンカッコカリ後の耐久値  
ケッコン前の最大耐久値及び「最大耐久値の最大値」にのみ依存する。艦種や艦型、ケッコンのタイミングなどの影響は受けない。
 
- HP < 30 : +4
- HP < 40 : +5
- HP < 50 : +6
- HP < 70 : +7
- HP < 90 : +8
- HP >= 90 : +9  

「最大耐久値の最大値」は艦ごとに個別に設定されており、この値を超えることはない。  
( 具体的には `api_start2.api_mst_ship.api_taik[1]` )  
殆どの艦では上記増分値を足しても問題ないほど大きく設定されているが、Bismarck drei など一部の艦娘はこれによって上昇量が制限されている。

#### パラメータの算出式  
対潜・回避・索敵の3種パラメータは、以下の式で求められる。  

```
value = min + int( ( max - min ) * Lv / 99 )  
```

なお、max = Lv99時点での値。  
「改装して最大値は変わらないが最小値が上昇する艦娘」(島風の回避など)の場合、Lv100を超えると改装前のほうが強くなることがある。  

火力・雷装・対空・装甲はレベルアップ時にランダムに上昇する(らしい)。  
なお、改装完了直後の火力・雷装・対空・装甲は、  

```
value = min + ceil( ( max - min ) * ( 0.4 or 0.8 ) * Lv / 99 )  
```

で求められる(0.4 or 0.8 はランダム)。  

#### 季節の衣替え艦娘  
クリスマス・年末・正月に衣装替えした艦娘のデータは ID 901 以降に保存されており、図鑑からのみ参照できる。  
~~なお、システム内では 501 以降の艦は深海棲艦として扱われるため、一応深海棲艦扱い。~~ 現在は修正済。  

2015/07/17アップデートによって、艦船マスターデータ(`api_mst_ship`)からデータが削除された。  
`api_mst_shipgraph` からのみアクセス可能となった。  

2016/05/02 アップデート('16 春イベ)時に、記念日シリーズ（具体的には、記念日夕雲・記念日長波・記念日春雨改・記念日瑞穂）の艦娘がマスターデータに追加された。  
理由としては、これらの艦娘には 900 以下のIDが降られており、クライアントに送信するマスターデータのフィルタ処理(ex. ID > 900 の艦娘は送信しない)から抜けてしまったものと考えられる。  
（なお、2016/05/03現在、従来の衣替え艦娘領域( 900 < ID < 1000 )はほぼ枯渇状態にある。それがID移動の原因かと考えられる。 ）  

以下に 2016/07/17 時点における ID と対応する艦娘及び衣装を示す。なお、名称は公式のものではない。

|ID|艦名|
|--:|:--|
|869|夏2016曙|
|870|夏2016朧|
|871|夏2016朧改|
|872|夏風雲|
|873|夏沖波|
|874|夏五十鈴|
|875|夏扶桑|
|876|夏山城|
|877|夏瑞穂|
|878|夏大和|
|879|夏榛名改二|
|880|夏大鯨|
|881|夏龍鳳|
|882|夏三隈|
|883|夏大淀|
|884|夏大淀改|
|885|夏Libeccio|
|886|夏Z3|
|887|梅雨曙|
|888|梅雨早霜|
|889|梅雨清霜|
|890|梅雨瑞穂|
|891|梅雨夕立改二|
|892|梅雨最上|
|893|梅雨夕張|
|894|梅雨千歳|
|895|梅雨千代田|
|896|携帯白露|
|897|記念日夕雲|
|898|記念日長波|
|899|記念日春雨改|
|900|記念日瑞穂|
|901|クリスマス那珂|
|902|クリスマス那珂改二|
|903|クリスマス時雨改二|
|904|クリスマス龍驤|
|905|クリスマス龍驤改二|
|906|クリスマス漣|
|907|大掃除曙|
|908|正月夕立改二|
|909|正月明石|
|910|正月明石改|
|911|正月大淀|
|912|正月大淀改|
|913|バレンタイン睦月|
|914|バレンタイン如月|
|915|バレンタイン叢雲|
|916|バレンタイン時雨改二|
|917|バレンタイン浜風|
|918|梅雨祥鳳|
|919|梅雨村雨改|
|920|梅雨高波|
|921|水着朧|
|922|水着曙|
|923|水着漣|
|924|水着潮|
|925|水着潮改二|
|926|水着白露改|
|927|水着時雨改二|
|928|水着夕立改二|
|929|水着村雨改|
|930|水着天龍|
|931|水着龍田|
|932|水着明石改|
|933|水着Littorio|
|934|水着Italia|
|935|浴衣朧|
|936|秋刀魚磯風|
|937|秋刀魚磯風改|
|938|浴衣浦風|
|939|浴衣浜風|
|940|浴衣江風|
|941|オクトーバーフェストZ1|
|942|秋刀魚雷|
|943|秋刀魚電|
|944|浴衣長良|
|945|浴衣名取|
|946|浴衣球磨|
|947|浴衣多摩|
|948|浴衣大淀改|
|949|浴衣神通改二|
|950|浴衣瑞穂|
|951|秋の味覚曙|
|952|秋の味覚潮|
|953|秋の味覚潮改二|
|954|秋の味覚村雨|
|955|秋の味覚千歳|
|956|秋の味覚千代田|
|957|秋の味覚春雨|
|958|ハロウィンRoma|
|959|ハロウィンLibeccio|
|960|クリスマス大淀|
|961|クリスマス大淀改|
|962|クリスマス谷風|
|963|クリスマス初風|
|964|クリスマス江風|
|965|クリスマスLittorio|
|966|クリスマスItalia|
|967|クリスマス鹿島|
|968|正月潮|
|969|正月潮改二|
|970|正月子日|
|971|正月夕雲|
|972|正月巻雲|
|973|正月大鯨|
|974|正月香取|
|975|正月瑞穂|
|976|正月秋津洲|
|977|正月扶桑|
|978|正月山城|
|979|正月瑞鳳|
|980|正月瑞鳳改|
|981|正月天城|
|982|正月伊401|
|983|節分清霜|
|984|節分瑞穂|
|985|バレンタイン曙|
|986|バレンタイン衣笠改二|
|987|バレンタイン瑞穂|
|988|バレンタイン弥生|
|989|バレンタイン卯月|
|990|バレンタイン春雨|
|991|バレンタイン鹿島|
|992|バレンタイン叢雲改二|
|993|牛丼明石改|
|994|牛丼大淀改|
|995|牛丼時雨改二|
|996|牛丼龍驤改二|
|997|牛丼瑞穂|

なお、ID: 882 「夏三隈」について、2016/08/31 現在 API 上において「夏三隅」と誤記されている。


#### SuperAAItem  
以下のアイテムが該当する。

* 3: 10cm連装高角砲
* 9: 46cm三連装砲
* 10: 12.7cm連装高角砲
* 35: 三式弾
* 48: 12.7cm単装高角砲

現在は未使用?  

#### 攻撃時の艦載機グラフィック

深海棲艦側は以下の通り。

* **1 (敵演習艦載機)**
    * IDにかかわらず、演習の艦載機は全てこれになる
* **2 (緑)**
    * 下記装備に該当しないもの
* **3 (オレンジ)**
    * 517: 深海棲艦攻 Mark.II
    * 520: 深海棲艦戦 Mark.II
    * 524: 深海棲艦爆 Mark.II
* **4 (青)**
    * 518: 深海棲艦攻 Mark.III
    * 521: 深海棲艦戦 Mark.III
    * 525: 深海棲艦偵察機
    * 526: 飛び魚偵察機
    * 544: 深海爆雷投射機 Mk.II *※522: 飛び魚艦戦の設定ミス？*
    * 546: 飛び魚艦爆
* **5 (たこ焼き艦戦)**
    * 547: 深海猫艦戦
    * 566: 深海猫艦戦(爆装)
* **6 (たこ焼き艦爆)**
    * 548: 深海地獄艦爆
* **7 (たこ焼き艦攻)**
    * 549: 深海復讐艦攻
    * 564: 深海水上偵察観測機
* **8(たこ焼き水爆)**
    * 554: 深海水上攻撃機
* **9(たこ焼き水爆elite)**
    * 555: 深海水上攻撃機改
* **10(たこ焼き艦戦elite)**
    * 556: 深海猫艦戦改
* **11(たこ焼き艦爆elite)**
    * 557: 深海地獄艦爆改
* **12(たこ焼き艦攻elite)**
    * 558: 深海復讐艦攻改
* **13(たこ焼き陸爆)**
    * 561: 深海解放陸爆
* **14(たこ焼き陸爆Ace)**
    * 562: 深海解放陸爆Ace

味方側(演習の敵艦隊を含む)の航空機グラフィックは、装備マスターデータの `api_type[4]` をもとにして決定される。  
概ね以下のように分類される。最新の情報は apilist.txt を、各航空機の分類は `api_start2` を参照せよ。

* 0: 非航空機
* 1: 艦上攻撃機/艦上偵察機
* 2: 水上偵察機/水上爆撃機
* 3: 水上戦闘機
* 4: 陸上攻撃機
* 11: 零戦前期型
* 12: 零戦後期型
* 13: 烈風
* 14: 海外機
* 15: 九九式艦爆
* 16: 彗星
* 17: 流星
* 18: 局地戦闘機
* 19: 大型飛行艇
* 20: 震電改

#### ダメージ処理  
実際の状態にかかわらず、15未満だと常に非クリティカル, 40以上だと常にクリティカルとして表示される。  
ちなみに、「命中したが0ダメージ」という状況も存在する。  
実際に出せるかはさておき、表示上の最大値は9999。  
また、「かばう」が発動した場合は 0.1 がフラグとして加算される(もちろん実ダメージには影響しない)。  
連合艦隊戦において、第二艦隊旗艦にかばうフラグが立つことがある（航空戦）。実際はどうなっているのか不明。  

#### 消費アイテム装備使用の優先度  

* ダメコン・戦闘糧食
    * 補強スロット ＞ メインスロット[0] ＞ … ＞ メインスロット[4]
* 洋上補給
    * 補強スロット ＞ メインスロット[4] ＞ … ＞ メインスロット[0] 

以上の順で発動・消費される。 
なお、発動した後は削除して詰めた後 -1 が末尾に補充される(補強スロットの場合は -1 に置換される)。  
削除処理は発動直後に行われ、同戦闘中の表示にも反映される(はず)。  

洋上補給の消費優先度については、

* 本隊6番艦 > ... > 本隊旗艦 [ > 随伴6番艦 > ... > 随伴旗艦 ]

となっている。洋上補給が可能な艦が複数存在する場合、この順に消費が行われる。

なお、旗艦大破ダメコン進撃時の消費判定は、次の戦闘が始まる直前に行われる。  
戦闘前に帰投したり再読み込みしたりした場合、消費も回復も発動しない。  
[実験時の様子はこちら。](https://twitter.com/andanteyk/status/727764443942277121)  


#### 探照灯の優先度
発動条件(HP>1)を満たす艦が複数いた場合は、

* (大型探照灯＞探照灯)＞旗艦に近いほう

の優先度で発動させる(1隻のみ)。  
条件を満たしていれば確実に発動するため、戦闘APIに対応する値は存在しない。

#### 挟叉  
命中フラグは以下のようになっている。  

* `HITFLG_NOATTACKED` : 攻撃せず(-1)
* `HITFLG_MISS` : ミス(0)
* `HITFLG_NORMAL` : 命中(1)
* `HITFLG_CRITICAL` : クリティカル(2)
* `HITFLG_KYOUSA` : 狭叉(3) (原文ママ, 未実装?)  

#### 航空支援について  
* 航空支援でも敵機を撃墜することは可能。  
ただし既に航空戦フェーズは終わっているので、狙ってまでする事ではなさそう。  
* 制空戦力は**熟練度を無視して**計算される。制空戦力の強い敵艦隊に出すときは注意が必要。

####レアリティの設定ミス  
以下に示す艦娘は、設定されたレアリティとグラフィック上のレアリティが異なる。  
なお、レアリティ値は8段階であり、 藍＜青＜水＜銀＜金＜虹＜輝虹＜桜虹 とする。

|艦名|設定レアリティ|グラフィック|
|:--|:--|:--|
|羽黒改二|金|虹|
|武蔵(改)|輝虹|桜虹|
|鹿島|水|銀|
|海風改|銀|金|
|秋津洲改|桜虹|輝虹|
|瑞穂改|金|虹|
|翔鶴改二(甲)|桜虹|輝虹|
|瑞鶴改二(甲)|桜虹|輝虹|

このレアリティデータは建造・ドロップ時及び撃沈時の背景表示に用いられる。

#### 撃沈・退避時のグラフィック  
R' = G' = B' = ( R + G + B ) / 3

#### ダメコン使用時の回復量
- 応急修理要員 : HP = int( HPMax * 0.2 )
    - 旗艦大破進撃時は HP = int( HPMax * 0.5 )
- 応急修理女神 : HP = HPMax ( +燃料・弾薬全回復 )  

#### 保有数による出撃時の制限  
なお、「装備空き」は補正後の値(艦これクライアントの表示値)に従う。

* 艦船がドロップしない条件  
艦船空き == 0 or 装備空き <= 3  
* イベント海域出撃不可条件  
艦船空き < 5 or 装備空き < 20

#### 攻撃種別  
* 昼戦
    * 0: 砲撃  
    * 1: レーザー攻撃
    * 2: 連続射撃
    * 3: カットイン(主砲/副砲)  
    * 4: カットイン(主砲/電探)
    * 5: カットイン(主砲/徹甲弾)
    * 6: カットイン(主砲/主砲)
    * 7: 空撃
    * 8: 爆雷攻撃
    * 9: 雷撃

* 夜戦
    * 0: 砲撃  
    * 1: 連続射撃
    * 2: カットイン(主砲/魚雷)
    * 3: カットイン(魚雷/魚雷)
    * 4: カットイン(主砲/主砲/副砲)
    * 5: カットイン(主砲/主砲/主砲)
    * 6: ???
    * 7: 空撃
    * 8: 爆雷攻撃
    * 9: 雷撃  

また、上記に加えて以下のフラグが存在する。詳細は後述の擬似コードを参照せよ。

* ロケットフラグ
* 大発動艇フラグ
* 内火艇フラグ

なお、連続射撃とカットイン ( 種別 1 ~ 6 ) は鯖側で計算され、残りは蔵側で計算される。  
計算処理を以下に示す。  

```
// 昼戦

if ( 対地装備 を装備している && 防御側 == 陸上施設 )
    ロケットフラグ = true;
if ( 大発動艇(八九式中戦車&陸戦隊) を装備している && 防御側の名前 == ( "離島棲姫" | "砲台小鬼" | "集積地棲姫" | "集積地棲姫-壊" ) )
    大発動艇フラグ = true;
if ( 特二式内火艇 を装備している ) {
    if ( 攻撃側 == ( 潜水艦 | 潜水空母 ) && 防御側 == 陸上施設 )
        内火艇フラグ = true;
    else if ( 防御側の名前 == ( "離島棲姫" | "砲台小鬼" | "集積地棲姫" | "集積地棲姫-壊" ) )
        内火艇フラグ = true;
}

if ( 攻撃種別が与えられている )     // 弾着観測砲撃(連撃, カットイン等)は鯖側で計算される
    return;

if ( ロケットフラグ == true )
    攻撃種別 = ロケット砲撃;      //番号は振られていない
else if ( 攻撃側 == 速吸改 ) {
    if ( 防御側 == ( 潜水艦 | 潜水空母 ) ) {
        if ( ( ( 対潜 > 0 の 艦上攻撃機 ) | 水上爆撃機 | オートジャイロ ) を装備している )
            攻撃種別 = 7(空撃);
        else
            攻撃種別 = 8(爆雷攻撃);
    } else if ( 艦上攻撃機 を装備している )
        攻撃種別 = 7(空撃);
    else
        攻撃種別 = 0(砲撃);
} else if ( 攻撃側 == ( 軽空母 | 正規空母 | 装甲空母 ) )
    攻撃種別 = 7(空撃);
else if ( 防御側 == ( 潜水艦 | 潜水空母 ) ) {
    if ( 攻撃側 == ( 航空巡洋艦 | 航空戦艦 | 水上機母艦 | 揚陸艦 ) )
        攻撃種別 = 7(空撃);
    else
        攻撃種別 = 8(爆雷攻撃);
} else if ( 最初の表示装備 == ( 魚雷 | 潜水艦魚雷 ) )
    攻撃種別 = 9(雷撃);
else
    攻撃種別 = 0(砲撃);
```

```
// 夜戦

if ( 対地装備 を装備している && 防御側 == 陸上施設 )
    ロケットフラグ = true;
if ( 大発動艇(八九式中戦車&陸戦隊) を装備している && 防御側の名前 == ( "離島棲姫" | "砲台小鬼" | "集積地棲姫" | "集積地棲姫-壊" ) )
    大発フラグ = true;
if ( 特二式内火艇 を装備している ) {
    if ( 攻撃側 == ( 潜水艦 | 潜水空母 ) && 防御側 == 陸上施設 )
        内火艇フラグ = true;
    else if ( 防御側の名前 == ( "離島棲姫" | "砲台小鬼" | "集積地棲姫" | "集積地棲姫-壊" ) )
        内火艇フラグ = true;
}

if ( 攻撃種別が与えられている )     // 夜戦特殊攻撃(連撃, カットイン等)は鯖側で計算される
    return;

if ( ロケットフラグ == true )
    攻撃種別 = ロケット砲撃;
if ( 攻撃側 == ( 軽空母 | 正規空母 | 装甲空母 ) ) {
    if ( 攻撃側 == ( Graf Zeppelin | Graf Zeppelin改 ) || 攻撃側の名前 == "リコリス棲姫" )
        攻撃種別 = 0(砲撃);
    else
        攻撃種別 = 7(空撃);
} else if ( 攻撃側 == ( 潜水艦 | 潜水空母 ) )
    攻撃種別 = 9(雷撃);
else if ( 防御側 == ( 潜水艦 | 潜水空母 ) ) {
    if ( 攻撃側 == ( 航空巡洋艦 | 航空戦艦 | 水上機母艦 | 揚陸艦 ) )
        攻撃種別 = 7(空撃);
    else
        攻撃種別 = 8(爆雷攻撃);
} else if ( 最初の表示装備 == ( 魚雷 | 潜水艦魚雷 ) )
    攻撃種別 = 9(雷撃);
else
    攻撃種別 = 0(砲撃);
```

なお、「最初の表示装備」は戦闘時にカットインとして表示される装備であり、第一スロットに装備されているアイテムとは異なる場合がある。  

大発動艇フラグか内火艇フラグが有効であり、かつ攻撃種別が `( 砲撃 | 空撃 | 爆雷攻撃 | 雷撃 | ロケット砲撃 )` のいずれかだった場合、追加でそれぞれの攻撃エフェクトが発生する。  
両方が有効だった場合は内火艇エフェクトが優先される。  

#### 対空カットイン  

|ID|必要装備|発動可能艦|
|--:|:--|:--|
| 1|高角砲x2/電探|秋月型|
| 2|高角砲/電探|秋月型|
| 3|高角砲x2|秋月型|
| 4|大口径主砲/三式弾/高射装置/電探||
| 5|高角砲+高射装置x2/電探||
| 6|大口径主砲/三式弾/高射装置||
| 7|高角砲/高射装置/電探||
| 8|高角砲+高射装置/電探||
| 9|高角砲/高射装置||
|10|高角砲/集中機銃/電探|摩耶改二|
|11|高角砲/集中機銃|摩耶改二|
|12|集中機銃/機銃/電探||
|13|???||
|14|高角砲/機銃/電探|五十鈴改二|
|15|高角砲/機銃|五十鈴改二|
|16|高角砲/機銃/電探|霞改二乙|
|17|高角砲/機銃|霞改二乙|
|18|集中機銃|皐月改二|

(個艦については)固有優先、他はID昇順優先で判定される？  
秋月型のみ対空電探(対空値が1以上の電探)でなくても可。  

以下の装備は「高角砲+高射装置」として扱われる：

* 122 : 10cm連装高角砲+高射装置
* 130 : 12.7cm高角砲+高射装置
* 135 : 90mm単装高角砲
* 172 : 5inch連装砲 Mk.28 mod.2

以下の装備は「集中機銃」として扱われる：

* 131 : 25mm三連装機銃 集中配備
* 173 : Bofors 40mm四連装機関砲
* 191 : QF 2ポンド8連装ポンポン砲


#### 敵ボイス  
`areaID` `mapNo` `index` `shipID`  

#### 装備種別  
* [0]: 大分類？
* [1]: 図鑑カテゴリ/戦闘分類(`getSlotItemCardType`)
* [2]: 装備種別(`getSlotItemEquipType`)
* [3]: アイコン(`getSlotItemIconType`)
* [4]: 航空機グラフィック種別

詳細については apilist.txt を参照すること。

#### 夜戦魚雷連撃  
一応実装されているらしい。  
連撃フラグが立っており、かつ攻撃表示装備[0]が( 小口径主砲/中口径主砲/大口径主砲/大口径主砲(II)/副砲 )でないときに発動する。  
そういったデータが送られてくることはないので通常の手段では見ることはできない。  

#### 対空能力の優先度？  
ある部分で使われている処理。何かの助けになるかもしれない

```
int flag = 0;
foreach ( 装備スロット ) {
	int priority = 0;
	if ( カテゴリ == 対空強化弾 ) priority = 1;
	else if ( アイコン == 高角砲 ) priority = 3;
	else if ( 装備 == 12cm30連装噴進砲 ) priority = 2;
	else if ( カテゴリ == 対空機銃 ) priority = 4;
	else if ( アイコン == 電探 && 対空 > 0 ) priority = 4;

	if ( priority > 0 && ( priority < flag || flag == 0 ) )
		flag = priority;	//優先度の高いものを選択
}
if ( flag == 2 ) flag = 3;
else if ( flag == 3 ) flag = 2;		//謎のスワップ 
return flag;
```

#### 泊地修理の仕様

用語を以下のように定義する。

* 「泊地修理タイマ」は各プレイヤーに1つだけ存在する。これは修理を開始した時にその時刻がセットされるものである(要するに `DateTime` 型の変数だと思えばよい)。  
* 泊地修理タイマに現在の時刻をセットすることを「スタート」とする。スタートしたとき、以前に設定されていた時刻は上書きされる。  
* 「修理可能な艦」は、入渠しておらず、遠征中ではない、 `50% < HP < 100%` である艦のことである。

「通常の編成を行った結果、旗艦が工作艦であるとき」に、タイマはスタートする。編成操作に工作艦が直接関わる必要はない。具体的には以下の状態などが挙げられる。

* 旗艦に工作艦を配置した
* 2番艦に工作艦がいるときに、1番艦をはずした
* 旗艦に工作艦がいるときに、2番艦と3番艦を入れ替えた
* 第1艦隊で旗艦に工作艦がいるときに、第2艦隊に第1艦隊の随伴艦を移動した

なお、「編成」は `api_req_hensei/change` を用いるものの一部（艦の追加/はずす/入れ替え/D&Dによる操作）であり、**随伴艦一括解除・編成記録/展開による編成・解体や近代化改修による除籍は含まない**。  
(撃沈による除籍は未確認であるが、おそらく解体と同じ扱いをされると思われる)  
また、工作艦が旗艦でない艦隊の編成操作はタイマに影響を及ぼさない。  
タイマのスタートでは、**旗艦(工作艦)の状態(入渠中、中破など)、修理可能な艦がいるかは一切問わない**。工作艦が旗艦でさえあればよい。  

よって、「編成」として扱われない編成記録/展開を利用することで、タイマを再スタート(リセット)させることなく編成の変更を行うことができる。  

母港に移動したときに下記の修理判定が行われる。  

* 「泊地修理タイマが20分経過していない場合」は、なにもしない
* 「泊地修理タイマが20分以上経過している場合」は、下記の修理実行判定を行う
    * 判定に成功すれば経過時間に応じてHPを回復する。
    * *判定の成否にかかわらず*、泊地修理タイマをスタートする。

修理実行判定は以下のすべてを満たせば成功である。

* 旗艦が中破していない
* 旗艦が入渠中でない
* 艦隊が遠征中でない
* 修理可能な艦が旗艦を含めて `(2 + 艦艇修理施設の装備数)` の範囲内に存在する
* 修理に必要な資源が足りている(注)

> (注) 資源の自然回復は、修理判定の後に行われる。そのため、自然回復で増えた資源はこの判定では無視される。
> なお、艦隊の先頭から順に修理処理を行っていく。資源が足りなければその艦はスキップされる。

実験時のログを以下に示す。

```
05:28 泊地修理開始　HP54
05:48 回復確認 HP55　同刻(15秒程)、「雷」を編成(リセット)
05:54 「雷」を解体
06:08 回復確認 HP56
06:13 小破未満ダメージの「明石」を編成記録、別の無傷明石を編成し修理開始
06:19 ダメージ「明石」編成展開、入渠を開始　直後に無傷明石を再度編成展開
06:33 回復確認 HP57
06:42 無傷「武蔵」に僚艦変更　ダメージ艦がいない状態に
06:45 小破未満ダメージ「伊勢」を編成展開
07:02 回復確認 HP58

09:49 中破「明石」を旗艦にして編成変更(リセット)　HP30
09:52 無傷「明石」の編成を展開
10:09 回復確認 HP31
10:11 入渠(中破)明石を旗艦にして編成変更(リセット)
10:15 バケツで明石を回復
10:31 回復確認 HP32

10:56 旗艦を工作艦以外にしてから20分以上経過した状態で、明石を編成展開(そのまま母港には戻らない)
11:17 母港に移動、回復確認 HP33
11:38 同様にタイマをリセットしてから明石を編成展開して母港に戻らず放置
11:52 母港に移動 変化なし
11:58 回復確認 HP34

14:20 「摩耶」を編成(リセット)
14:29 「摩耶」を近代化改修により除籍
14:42 回復確認

14:54 無傷艦のみで編成
15:15 母港に戻る
15:25 ダメージ艦を編成展開　HP67
15:35 回復確認　HP68

15:47 明石旗艦、天津風(HP36/39)随伴、遠征隊出発(長距離練習航海)
16:12 母港へ戻る　当然回復せず
16:16 遠征帰投　回復せず
16:32 回復確認 HP37

21:05　修理開始
21:15　随伴艦一括解除
21:20　編成展開で修理可能艦を編成
21:25　回復確認

23:14　修理開始
23:26　ダメージ艦を1隻第3艦隊に移動(第3艦隊側から操作)
23:34　修理されず(別艦隊からの編成でもタイマがリセットされる)

23:46　修理から20分経過後に母港を開く(非修理編成)
23:57　編成展開で修理可能艦を編成
00:06　回復確認
```

ツールの実装としては、

* `api_req_hensei/change` で変化した艦隊の旗艦が工作艦なら `timer = Now` ※但し随伴艦一括解除の場合は無視する
* `api_port/port` で、`( Now - timer ) >= 20min` なら `timer = Now`

でほぼ再現できるはずである。

参考文献：[【プリセット明石修理】明石カウンターの詳細についての仮説 及びツール作成者様に対応お願いしたいことについて:ﾆﾗのブロマガ - ブロマガ](http://ch.nicovideo.jp/nila/blomaga/ar904333)

#### 時報の読み込みタイミング  
サーバの混雑を回避するためか、時間の5分ほど前から読み込みを開始することがある。  
詳細は未調査。  

#### 戦闘勝利判定  
確証はないが(特に撃沈艦ありのとき)、観測儀では以下のように実装*していた*。

```
味方損害率 = int( ( 味方開始時HP - 味方終了時HP ) / 味方開始時HP * 100 );
敵損害率 = int( ( 敵開始時HP - 敵終了時HP ) / 敵開始時HP * 100 );

if ( 敵損害率 >= 100 ) {
    if ( 味方損害率 <= 0 ) { //ダメコン発動時に負になる可能性がある
        rank = SS;
    } else {
        rank = S;
    }
} else if ( 敵撃沈数 >= round( 敵艦総数 * 0.6 ) ) {
    rank = A;
} else if ( 敵旗艦撃沈 || 敵損害率 > 味方損害率 * 2.5 ) {
    rank = B;
} else if ( 敵損害率 > 味方損害率 || 敵損害率 >= 50 ) {
    rank = C;
} else {
    rank = D;
}

if ( 味方に撃沈艦がある ) {
    rank = min( rank, A ) - 1;
}
```

なお、連合艦隊での判定は少なくとも「本隊だけ」ではない模様。調査中  
ver. 0.2.1 現在、観測儀では本体・随伴隊全員の損害率を計算している。  

損害率が自軍71.5%/敵軍67.6%(旗艦生存/撃沈3隻)、自軍62.2%/敵軍57.8%(旗艦生存/撃沈3隻)でC敗北となったことがある。  
敵側の損害率が一定以上だとC敗北になる？  
C敗北判定の 敵損害率 >= 50 は試験実装。  
これまでの例外判定メモ：  

* 自軍71.5%/敵軍67.6%(旗艦生存/撃沈3隻); 判定D→実際C
* 自軍62.2%/敵軍57.8%(旗艦生存/撃沈3隻); 判定D→実際C
* 自軍32.5%/敵軍32.7%(旗艦生存/撃沈2隻); 判定D→実際C

現在は航海日誌拡張版と同じ判定式。


##### 長距離空襲戦での勝利判定
'16 冬イベで実装された長距離空襲戦では、こちらから攻撃できないためか、一般の勝利判定とは計算が異なる模様。  
2016/02/19 現在、以下のように推測されている。

```
味方損害率 = int( ( 味方開始時HP - 味方終了時HP ) / 味方開始時HP * 100 );

if ( 味方損害率 <= 0 )
    rank = SS;
else if ( 味方損害率 < 10 )
    rank = A;
else if ( 味方損害率 < 20 )
    rank = B;
else if ( 味方損害率 < 50 )
    rank = C;
else if ( 味方損害率 < 80 )
    rank = D;
else
    rank = E;
```

通常時とは異なり、撃沈艦の有無は勝利判定に含まない模様（撃沈1隻でもA勝利が、撃沈艦なしでもE敗北が取れる）。  

#### 一度に大破できる艦数  
表示上は3隻まで。当然であるが中大破自体はおそらく何隻でも可能。  
[スクリーンショットはこちら](https://twitter.com/andanteyk/status/655400064278360064)。  

#### 連合艦隊における電探の渦潮被害軽減効果  
艦隊ごとに判定されるため、どちらの艦隊にも載せる必要がある。  
なお、'16 夏イベントの E-4 で、第一艦隊にのみ燃料ダメージを与える渦潮が確認されている。  
API 上は通常の(随伴艦隊にもダメージを与える)ものと区別はできない。  

#### '15 冬イベントの海域ゲージHP  
全て甲作戦のもの。

* E-1 : 192 (旗艦HP45; 最低5回撃破)
* E-2 : 720 (旗艦HP通常96/最終160 160以下で最終形態 最低7回撃破)
* E-3 : 1050 (旗艦HP270; 最低4回撃破)
* E-4 : 1925 (旗艦HP350; 最低6回撃破)
* E-5 : 3000 (旗艦HP500; 最低6回撃破)

#### '15 春イベントの海域ゲージHP  
全て甲作戦のもの。

* E-1 : 440 (旗艦HP88; 最低5回撃破)
* E-2 : 1620 (旗艦HP270; 最低6回撃破)
* E-3 : 910 (旗艦HP130; 最低7回撃破)
* E-4 : 3200 (旗艦HP450(最終形態500); 最低7回撃破)
* E-5 : 2410 (旗艦HP330(最終形態430); 最低7回撃破)
* E-6 : 3405 (旗艦HP500; 最低7回撃破)

#### '15 夏イベントの海域ゲージHP
全て甲作戦、司令部Lv120のもの。

* E-1 : 750 (旗艦HP150; 最低5回撃破)
* E-2 : 1050 (旗艦HP270; 最低4回撃破)
* E-3 : 2100 (旗艦HP350; 最低6回撃破)
* E-4 : 3500 (旗艦HP500; 最低7回撃破)
* E-5 : 2450 (旗艦HP400; 最低7回撃破)
* E-6 : 2800 (旗艦HP350; 最低8回撃破)
* E-7 : 2040 (旗艦HP255; 最低8回撃破)

#### 海域HPゲージ  
* わずかでもダメージを与えないと正常な値にならない。  
    (ex. 初期は300/300でも、30ダメージ与えると2370/2400になる、など)  
    最大HPが1000以上だと正しく取得できる？  
* '15冬イベ以前は初期値300、'15冬イベ以降は9999  
* '15春イベでは難易度を選択した時点で決定される？  
* '15春イベ/夏イベにて、司令部Lvによって海域HPが変化する仕様が確認されている。
* ボスが最終形態になるかどうかは、前哨戦のボスHPに依存する模様(前哨戦ボスHP600ならば、600以下になった時に最終形態に移行する)。  
    そのため、 `前哨戦HP > 最終戦HP` の場合、最終形態を複数回倒さなければならない。

#### 猫った時のAPIレスポンス  
練習巡洋艦旗艦で開発すると落ちる不具合を利用したもの。(2015/02/08)  

* `api_result` : 100  
* `api_result_msg` : "申し訳ありませんがブラウザを再起動し再ログインしてください。"

`api_result` については、201などといった値をとることもある。

また時々、もはや JSON ですらない HTML データが送られてくることもある。  
内容は主にデータベースエラーのログであり、エラーが発生した PHP ファイルのパスやレコード名などを知ることができる。

#### 特殊な装備判定(改装UI)  
Bismarck dreiに対する魚雷装備・試製51cm連装砲といったものの装備判定は、改装UIシステムの中で*例外的に決め打ち*されている。  
具体的には、

|対象艦|装備可能|装備不可能|
|:--|:--|:--|
|Bismarck drei|魚雷||
|大和改, 武蔵改, 長門改, 陸奥改|大口径主砲(II)・水上戦闘機||
|大和, 武蔵|大口径主砲(II)||
|秋津洲|大型飛行艇|特殊潜航艇・上陸用舟艇・対地装備・特型内火艇|
|秋津洲改|大型飛行艇・ソナー・航空要員|特殊潜航艇|
|阿武隈改二|特殊潜航艇・上陸用舟艇・特型内火艇||
|速吸改|艦上攻撃機・大型電探・ソナー・上陸用舟艇・特型内火艇||
|香取改, 鹿島改|探照灯||
|霞改二|上陸用舟艇・司令部施設・特型内火艇||
|霞改二乙|大型電探・上陸用舟艇・特型内火艇||
|Italia, Roma改, Zara改, Pola改|水上爆撃機・水上戦闘機||
|皐月改二, 大潮改二, 朝潮改二丁|上陸用舟艇・特型内火艇||
|Верный|上陸用舟艇・追加装甲(中型)・特型内火艇||
|睦月改二, 如月改二, 江風改二|上陸用舟艇||

となっている。  
(艦船IDが特殊装備リストに含まれていた場合は*マスターデータの内容にかかわらず*装備可能・不可能にする、というコードになっている)  
つまりある意味では不正な装備ともいえる(?)  
~~そのために新艦種を追加するのも面倒なのは分かるが、ちょっとこれはひどい気がする~~  

判定自体については `RemodelMain.swf/scene/remodel/view/changeEquip/EquipList.as` を参照すること。

#### 特殊な装備判定(`SLOTITEM_SPECIAL_FLAGS`)  
 
以下に示す一部の装備は、 `api_start2` (マスターデータ) の装備カテゴリと、実際の装備カテゴリが異なる。  
これらは、「改修画面等のカテゴリ表示ではマスターデータに従うが、実際に装備できるか・ソート順は別判定」という不思議な挙動を示す。  

|装備ID(装備名)|APIのカテゴリ|実際のカテゴリ|
|:--|:--|:--|
|128(試製51cm連装砲)|3(大口径主砲)|38(大口径主砲(II))|
|142(15m二重測距儀＋21号電探改二)|13(大型電探)|93(大型電探(II))|
|151(試製景雲(艦偵型))|9(艦上偵察機)|94(艦上偵察機(II))|

これは、艦これの装備システムが「装備可能な装備カテゴリリストの作成 → それに応じて `unsetslot` から装備を抽出」の順で処理を行うため、マスターデータの装備カテゴリではなく `unsetslot` においてどのカテゴリにあるかで判定するためである。  

`unsetslot` ( `api_get_member/unsetslot` 及びそれと同じフォーマットを持つデータ群 )は、誰も装備していない装備のIDをカテゴリ別にリスト化したものである。  
このリスト化は、**マスターデータの装備カテゴリには依存しない**。サーバ側で独自に決定される。  
そのため、上記の装備群はマスターデータの指定とは異なる装備種の扱いを受ける。  

ここで、廃棄処理においてクライアント側で「装備データの削除 → `unsetslot` に装備IDがあればそれも削除」という処理を行っているのだが、マスターデータのカテゴリと `unsetslot` のカテゴリが異なるために、どの `unsetslot` に属しているかが判らないという問題が発生する。 
これを解決するために、Flash 内部に `SLOTITEM_SPECIAL_FLAGS` という 装備IDをキー・置換後装備カテゴリを値とするオブジェクトが存在する。クライアントはこれを利用して削除処理を行う。  

しかしさらに問題なのが、 `SLOTITEM_SPECIAL_FLAGS` と実際のカテゴリ分けに齟齬がある、という点である。  
`SLOTITEM_SPECIAL_FLAGS` の 2015/11/25 時点での設定値を以下に示す。  

|装備ID|置換カテゴリ|
|--:|--:|
|128|38|
|142|43|

先程示した表と照らし合わせて見ると、142(15m二重測距儀＋21号電探改二)はカテゴリ間違い、151(試製景雲(艦偵型))に至ってはそもそも値が存在しないことが分かる。  
(ちなみに 142 の間違いは、実装当初は大型電探(II)のIDが 43 だったのが 2015/08/10 アップデートで 93 に変更されたことに起因する。)   
その結果、この2つの装備を廃棄すると「装備の削除には成功するが `unsetslot` からの削除に失敗する」状態となり、クライアントがクラッシュする(猫る)。  
廃棄API自体は正常に成功するため、再ログイン時に当該装備は削除された状態となる。  

 * [実際に廃棄した様子](https://twitter.com/uma_meshi/status/640180238954033156/photo/1)  
 * [装備は削除される](https://twitter.com/uma_meshi/status/640181133259333632)  

なお、図鑑での表示では、図鑑APIに装備カテゴリが含まれており、そちらを参照して表示を行う(こちらの値は `unsetslot` のカテゴリ分けと同じになっている)。  
そのため、上記のような表示のずれは発生しない。  

> ~~なお、2016/02/24 オンメンテで実装された 164: Ro.44水上戦闘機 は、図鑑での表示カテゴリが他の水上爆撃機とは異なるが、実際のカテゴリ設定は他と同じ ID: 11 (水上爆撃機) である。~~  
> ~~これについては図鑑UI上で決め打ちされており、カテゴリID: 150 (多用途水上機/水上爆撃機/水上戦闘機)として扱われている。~~  
> 現在は「水上戦闘機」カテゴリに移動したため、この処理はなくなった。

#### 主要な任務一覧  

|任務ID|任務名|達成条件|備考|
|--:|:--|:--|:--|
|201|敵艦隊を撃破せよ！|勝利1
|216|敵艦隊主力を撃滅せよ！|戦闘1
|210|敵艦隊を10回邀撃せよ！|戦闘10
|211|敵空母を3隻撃沈せよ！|空母3
|212|敵輸送船団を叩け！|輸送5
|218|敵補給艦を3隻撃沈せよ！|輸送3
|226|南西諸島海域の制海権を握れ！|2-(1~5)ボス勝利5
|230|敵潜水艦を制圧せよ！|潜水6
|213|海上通商破壊作戦|輸送20
|214|あ号作戦|出撃36/S勝利6/ボス24/ボス勝利12
|220|い号作戦|空母20
|221|ろ号作戦|輸送50
|228|海上護衛戦|潜水15
|229|敵東方艦隊を撃滅せよ！|4-(1~5)ボス勝利12
|242|敵東方中枢艦隊を撃破せよ！|4-4ボス勝利1
|243|南方海域珊瑚諸島沖の制空権を握れ！|5-2ボスS勝利2
|261|海上輸送路の安全確保に努めよ！|1-5ボスA勝利3
|241|敵北方艦隊主力を撃滅せよ！|3-(3~5)ボス勝利5
|256|「潜水艦隊」出撃せよ！|6-1ボスS勝利3
|257|「水雷戦隊」南西へ！|1-4ボスS勝利1|要軽巡旗艦、軽巡3隻まで、他駆逐艦　他艦種禁止
|249|「第五戦隊」出撃せよ！|2-5ボスS勝利1|要「那智」「妙高」「羽黒」
|259|「水上打撃部隊」南方へ！|5-1ボスS勝利1|要(戦艦or航戦)3/軽巡1　巡戦禁止、戦艦追加禁止
|265|海上護衛強化月間|1-5ボスA勝利10
|264|「空母機動部隊」西へ！|4-2ボスS勝利1|要(空母or軽母)2/駆逐2
|266|「水上反撃部隊」突入せよ！|2-5ボスS勝利1|要駆逐旗艦、重巡1軽巡1駆逐4
|822|沖ノ島海域迎撃戦|2-4ボスS勝利2|クォータリー(その他扱い)
|303|「演習」で練度向上！|演習3
|304|「演習」で他提督を圧倒せよ！|演習勝利5
|302|大規模演習|演習勝利20
|311|精鋭艦隊演習|演習勝利7|マンスリーだが1日で進捗リセット
|402|「遠征」を3回成功させよう！|遠征成功3
|403|「遠征」を10回成功させよう！|遠征成功10
|404|大規模遠征作戦、発令！|遠征成功30
|410|南方への輸送作戦を成功させよ！|「東京急行」「東京急行(弐)」成功1
|411|南方への鼠輸送を継続実施せよ！|「東京急行」「東京急行(弐)」成功6
|503|艦隊大整備！|入渠5
|504|艦隊酒保祭り！|補給15回
|605|新装備「開発」指令|開発1
|606|新造艦「建造」指令|建造1
|607|装備「開発」集中強化！|開発3
|608|艦娘「建造」艦隊強化！|建造3
|609|軍縮条約対応！|解体2
|619|装備の改修強化|装備改修1(失敗可)
|613|資源の再利用|廃棄24回
|638|対空機銃量産|機銃廃棄6個|回ではない
|626|精鋭「艦戦」隊の新編成|熟練搭乗員+零式艦戦21型》装備の鳳翔旗艦+零式艦戦21型x2・九六式艦戦x1廃棄
|628|機種転換|零式艦戦21型(熟練)》装備の空母旗艦+零式艦戦52型x2廃棄
|637|「熟練搭乗員」養成|九六式艦戦》★10装備の鳳翔旗艦+勲章2|クォータリー
|643|主力「陸攻」の調達|零式艦戦21型x2廃棄+(九六式陸攻x1+九七式艦攻x2)保有|クォータリー？
|645|「洋上補給」物資の調達|三式弾廃棄+(燃料750+弾薬750+ドラム缶(輸送用)x2+九一式徹甲弾)保有
|702|艦の「近代化改修」を実施せよ！|改修成功2
|703|「近代化改修」を進め、戦備を整えよ！|改修成功15

#### 任務の特殊仕様について

* デイリー開発・建造任務はカウンタが共用。2回目の操作(3回任務の1回目)を行った時点で50%になる
* 東京急行遠征任務も共用。7回とあるが6回でok
* 輸送船5隻の変則デイリーと輸送船3隻のデイリーはカウンタが干渉。1隻撃沈で2増える
    * 場合によっては3隻撃沈のほうが「80%以上達成」になることがある（2/3=50%, 3/3は達成となるため本来発生しえない）
* あ号作戦の「出撃」は文字通りであり、戦闘を行う必要はない(ex. 6-1で戦艦2を含めて即帰投しても増える)
* 精鋭艦隊演習はマンスリーだが、デイリー(翌朝5:00)で進捗がリセットされる。
* 機種転換系任務において「機種転換」「部隊編成」でメッセージが異なったり、「熟練搭乗員」を要求する場合があるが、これらの処理は `Consts` に書かれているリストに載っているかで判定される。

##### クライアント側で達成判定がなされる任務

* 641:「航空基地設営」事前準備
* 642: 「陸攻」隊の増勢
* 643: 主力「陸攻」の調達
* 644: 「一式陸攻」性能向上型の調達
* 645: 「洋上補給」物資の調達
* 646: 「特注家具」の調達
* 647: 中部海域「基地航空隊」展開！

以上の任務には、このような特性が存在する。

* すべて「～を廃棄、～を保有(達成時消滅)」という達成条件である
* 達成していたとしても `api_state` が 2 (遂行中) のままである  
* 廃棄を完了していた場合、 `api_progress_flag` が 1 (50%以上達成) ないし 2 (80%以上達成) になることがある
    * 蔵側には異なる進捗率が表示されることがある

これは、装備の保有判定を蔵側で行っており、それによって達成/遂行中を切り替えているためである。  


#### EnemySlotItemImage

`Consts`に存在する、敵艦装備グラフィックの置換処理らしきもの。  

敵艦装備のグラフィックはカットイン発動時に確認することができるが、特に指定のない場合 `EquipmentID-500` 、すなわちIDインデックスの同じ味方側装備が表示される。  
(ex. 507: 14inch連装砲 = 7 : 35.6cm連装砲)  

> おそらくこの仕様を利用するため、初期の敵側の装備は艦娘の装備と一対一対応するようになっている (ID: 541 まで) 。  
> そのためか、この領域内には未使用の装備が存在する。

しかし、以下の装備は特定の装備グラフィックを持つよう指定されている。

|装備ID|装備名|置換装備ID|置換装備名|
|--:|:--|--:|:--|
|550|5inch連装両用莢砲|3|10cm連装高角砲|
|551|20inch連装砲|128|試製51cm連装砲|
|552|15inch要塞砲|76|38cm連装砲|
|553|4inch連装両用砲+CIC|3|10cm連装高角砲|
|563|8inch長射程連装砲|162|203mm/53 連装砲|
|565|5inch沿岸設置砲|78|12.7cm単装砲|
|567|沿岸設置レーダー|13|61cm三連装魚雷|

> 567(沿岸設置レーダー)については、31(32号対水上電探)だったはずが typo したものと考えられる。

~~なお、2015/05/30現在これらを装備している艦はカットイン攻撃を行わないため、実際に確認することはできない。~~  
2016/02/10('16 冬イベアップデート)で実装された「重巡棲姫」が、「8inch長射程連装砲」を用いたカットイン攻撃を行ってくるため、ようやく確認できた。  

またこれとは関係は薄いが、ID:515「高速深海魚雷」のカットイン文字が「22inch魚雷後期型」となる現象が確認されている。  
これはID:514「21inch魚雷後期型」とは異なるため、当初の命名はこちらだったのかもしれない。  

#### オンメンテで実装された艦娘の扱い

オンメンテ前のテーブルで確保してある「なし」領域を埋めるように実装される。  
そのため、メンテ前の情報を保持した蔵が新規実装艦を持つ艦隊と演習しても落ちることはない。  

但しその際、当然ながら(表示上の)パラメータ及び処理は「なし」のデータに基づくため、以下のような現象が発生する。  

* 艦種は駆逐艦、艦名は「なし」
* グラフィック自体は新規艦のものが表示される
* 演習開始時のカットインでグラフィックが左上に大きくずれる
* 速力が0のため(もちろん表示上のみだが)陸上基地扱い。当然バナーも「混乱」「損壊」といった表示になる

当然ではあるが、戦闘自体はサーバ側の演算によるので全く問題はない(潜水艦が駆逐艦扱いになって砲撃する、などといったことはない)。

具体的な「なし」のパラメータについては以下のとおりである。ほぼ0で埋められている。

|パラメータ|値|
|:--|:--|
|図鑑番号|0|
|艦名|"なし"|
|読み|"なし"|
|艦種|駆逐艦|
|改装|不可|
|耐久|0(戦闘時に与えられる)|
|各種パラメータ|0|
|速力|0(陸上基地)|
|射程|無|
|レア|0|
|スロット数|0|
|搭載機数|全て0|
|建造時間|0|
|解体資源|0/0/0/0|
|近代化改修増加値|0/0/0/0|
|ドロップ文章|*(なし)*|
|搭載燃料/弾薬|0/0|
|ボイスフラグ|0|
|リソース名|(一意の文字列)|

また、新規実装ボイスを持つ艦は、母港については再読み込みしなくても新しいボイスが再生される。  
但し時報・放置ボイスまで適用されるかは未確認。データ上は未実装扱いのはずなので再生されない？  

#### 連合艦隊経験値バグ

'15 春イベで確認。  
戦闘結果で表示された入手経験値と実際に入手した経験値が食い違うバグ。  
連合艦隊戦で退避艦が存在するときに発生する。  

具体的には、第一艦隊・第二艦隊ともに退避艦があるときに  

* 第一艦隊六番艦に旗艦MVP相当の経験値  
* 第二艦隊MVP艦の経験値が非MVP艦と変わらない
* 第二艦隊五番艦・六番艦は経験値0(もちろん退避はしていない)

といった現象が発生したりする。(あくまで一例であり、状況によって異なる。)  
なお、戦闘結果画面は通常どおり(本来の仕様通り)表示される。この表示と実際の取得経験値が異なるのが問題である。  

これが発生すると、入手経験値が「増える」「減る」「0になる」の3通りの現象が発生する。  
このバグで余分に入った経験値でnext. が0以下になってもレベルアップしない。(処理が行われないらしく、next. が負値になったままの状態になる。次の戦闘でレベルアップ処理が行われる。)  
こちらは未確認だが、同様に「必要経験値未満でもレベルアップする」現象が発生するかもしれない。

以下は推測であるが、「退避艦を除外した上で計算している」のが原因であると思われる。  
例えば、以下のような取得経験値となったとする。@ はMVPである。

|第一艦隊|第二艦隊|
|--:|--:|
|1200 @|600|
|400|400|
|400|0(退避)|
|0(退避)|400|
|400|800 @|
|400|400|

本来ならばこのように処理されるべきであるが、どうやら退避艦をこのリストからスキップして詰めるらしく、以下のように処理される：

|第一艦隊|第二艦隊|
|--:|--:|
|1200 @|400|
|400|400|
|400|800|
|400|400|
|400|0 @|
|600|0|

退避艦をスキップしたため空いた2-5, 2-6は0で埋められる。  
そのうえで退避艦処理をさらに行うため、

|第一艦隊|第二艦隊|
|--:|--:|
|1200 @|*400*|
|400|400|
|400|0(退避)|
|0(退避)|400|
|400|*0 @*|
|*600*|*0*|

となる。結果として、*斜体で示した艦*の経験値がずれる。  

第二艦隊のみに退避艦がいた場合、第一艦隊は通常通りで第二艦隊の退避艦以降の艦の経験値のみがずれ込むので、多分このような処理になっていると思う。  

この不具合があるため、第二艦隊五番艦と六番艦は退避発動中は経験値を得ることができない。4隻以上退避した場合は未確認であるが、同様に経験値の不審な増減が発生するものと思われる。    
育成においては注意が必要である。  

なお、連合艦隊でなくても轟沈艦が存在した場合に同様の現象が起こる、との噂がある。  

**このバグは '15 夏イベで修正された模様。** ログを確認したが上に述べた現象は発生していなかった。

#### 演習経験値バグ

演習で撃沈判定を受けた艦娘の経験値が減少するバグ。

上記経験値バグの検証の一環で、演習で撃沈判定を発生させて実験してみたところ、上に挙げたような経験値のずれは確認されなかった。  
しかし、撃沈判定を受けた艦の累積取得経験値が -1 されるという現象が発生した(戦闘結果での表示上は `+ 0 exp`)。  
確かに戦闘結果のAPIの取得経験値の項目は -1 になっていたが、直接適用されたのは予想外。  

Lv. 99の艦を以上の状態におき経験値を -1 させたところ、 Lv. 99 / 999999 exp. / next. 0 になった。  
この状態で別の戦闘を行ったところ、戦闘結果では「次のレベルまで」に何も表示されなかった(通常のLv99と同じ扱い)が、実経験値は 1000000 exp.に戻っていた。  
exp を -1 した状態でもケッコンカッコカリを行うことができる。この場合は、 Lv. 100 / 999999 exp. / next. 10001 となった。  
また、Lv. 1 / 0 exp. / next. 100 の状態でこの現象を発生させたところ、 Lv. 1 / -1 exp. / next. 101 となった。

> 注: 経験値0の大破艦は、単艦で5-5に出撃した後戦闘結果を見る前に再読み込みするとほぼ確実に入手することができる。

以上をまとめるとこのようになる。

* 演習で撃沈判定を受けると累積経験値が -1 される
* これによってレベルが下がる・レベルが上げられなくなる・ケッコンできなくなるといったことはない
* 減少した経験値はLv99でも(おそらくLv150でも)上限まで再入手できる
* Lv99で減少した経験値はケッコン後も引き継がれる(100万に補正されない) 
* 累積経験値は負値にすることができる

これによって何らかの不具合が出るかは未確認。  
経験値計算に艦の累積経験値を利用しているらしい演習において、経験値が負値の艦隊と演習したらどうなるのだろうか…

#### MVPの優先度

与ダメージによって判定される。  
与ダメージが同じ艦が存在する場合は、ランダムであると推測している。  
与ダメージが同じ場合の判定では、少なくとも、

* 先に攻撃したほう
* 後から攻撃したほう
* 旗艦に近いほう
* 6番艦に近いほう
* 第一砲撃戦で先に攻撃したほう
* 〃後に攻撃したほう
* 旗艦 > 6番艦 > 5番艦 > …

については反例が存在する。  
以下に調査時のデータを示す。  

```
航空戦無視(与ダメトップに関与しない艦)
北上 #1   開幕雷撃
長門 #3   砲撃
これらの艦に他の与ダメージ無
実際のMVP　北上

こちら潜水艦隊　航空戦無
先制雷撃
#2 153dmg / #4 150dmg
雷撃
#2 43dmg / #4 46dmg
実際のMVP #4

同じく潜水艦隊
開幕雷撃
#4 46dmg / #5 37dmg
雷撃
#4 32dmg / #5 41dmg
実際のMVP #5

同じく
開幕雷撃
#2 84dmg / #3 94dmg
雷撃
#2 82dmg / #3 72dmg
実際のMVP #3

演習
航空戦　自軍与ダメージ0
砲撃1
#3 62dmg #2 91dmg
砲撃2
#2 103dmg #3 132dmg
ともに雷撃0ダメージ
夜戦
ともに行動せず
MVP #2

同じく演習
航空戦関与せず
砲撃1
#3 122dmg, #4 123dmg
砲撃2
#3 105dmg, #4 104dmg
雷撃/夜戦無
MVP #4

1-1 キラ付け編成
砲撃1
#2 14dmg, #3 14dmg
MVP #3

潜水艦隊
開幕雷撃
#1 95dmg, #3 108dmg
雷撃
#1 108dmg, #3 95dmg
MVP #1

1-1 キラ付け編成
砲撃1
#3 13dmg, #2 13dmg
MVP #3
```

また、MVPになる条件として「与ダメージが1以上」が存在する。D敗北以上の判定で条件を満たす艦が1隻も存在しない場合(全員の与ダメージが0の場合)、後続条件にかかわらず旗艦がMVPとなる。

#### 突然の入渠API

2015/05/28(暁改二アップデート前日)、シーンにかかわらず(図鑑や出撃・戦闘中ですら)突然入渠APIが呼び出される現象が発生した。  
タイミングとしては「入渠中の艦の待ち時間が00:00:00になった瞬間」である。[画面下部の通信プログレスバー(?)が表示されたため](https://twitter.com/andanteyk/status/603934695819083777/photo/1)、正規クライアントによる通信であることは明らかである。  
起動直後は発生せず、しばらく経過すると発生していた。特定の操作をトリガーにしていた可能性がある。  
なお、その際「2回連続でndockリクエストを送る」現象も確認されている。例えば、

```
battle.request
battle.response
ndock.request
ndock.request
ndock.response
ndock.response
battleresult.request
battleresult.response
```

といった通信が行われていたことを確認している。  
時間経過とともに通信回数が増える(最初は0回(発生しない)→1回→2回(上記))。  
このような冗長な通信を正規に行うとは考えにくいため、クライアントに何らかの不具合が発生しているものと推察される。  
通信中はUI操作がブロックされるため、地味に厄介。  

[twitter](https://twitter.com/RizaSTAR/status/601763671119831041)にて、5/22時点ですでに発生していたらしき報告有。

#### next 非表示バグ
Lv148→149にレベルアップした時に、戦闘結果画面の next. がLv99・Lv150の時のように空欄になるバグ。  
サーバーからnext. のデータが送られてこないために発生する。  
この現象が発生するのはレベルアップ時のみで、以降は通常通り表示される。  

2015/12/08 アップデートによりLv上限が155になったが、その影響で上記問題の発生が Lv153→154 の時に変更された。  
不具合自体は修正されなかったらしい。  

#### 応急修理要員の画像が読み込めない問題
2015/07/29現在、応急修理要員の`item_up`及び`item_character`の画像にアクセスできなくなっている。(`404 Not found` とのこと)  
画像をうっかり消してしまったのだろうか？  
wiki曰く、同年5月ごろには既にこの問題が確認されていた模様。  

 * 2014/02/03 の書き込みにもそれらしき報告がある。

#### 装備図鑑でクリックできないバグ
図鑑を開いてすぐに「装備図鑑(2)」を開くと、「彗星一二型甲」のページが開けなくなるバグ。  
別のページを経由すればクリックできるようになる。発生原因は不明。  
2015/10/09 アップデートにより、ページが変更になったためか発生しなくなった。

#### 補強スロットについて
(応急修理要員/戦闘糧食/補給物資)を、艦娘自体の装備可能リストに積演算(and)したものが装備可能。(2015/08/18現在意味を持たないが)積演算は特殊装備判定の後に行われる。  
よって補給物資は補給艦のみ装備可能。  
この装備リストは `api_start2/api_mst_equip_exslot` を参照。  
なお、一応見張員判定は補強スロットも参照するようになっている(2015/08/18現在装備することはできない)。

#### 艦載機熟練度のデフォルト値
(熟練)及び(○○隊)はLv.2、(○○空)はLv.1になる。

#### 離島棲鬼 Lv. 3
'15 夏イベント E-7-Y の離島棲鬼のレベルは通常1であるが、時々3になることがある。  
装備やその他のパラメータ、編成に変化は見られなかった。  
難易度丙・甲ともに確認されている。乙では未確認であるが、出現していた可能性は高い。  
[丙作戦で5回中5回すべてが Lv. 3 だったという報告](https://twitter.com/KancolleSniffer/status/637656603823579137)もある。  

後日調査を行った。以下に交戦記録を示す。

|状況|Lv.|
|--:|:--|
|丙 #1|3|
|#2|1|
|#3|1|
|翌日 甲 #1|1|
|#2|1|
|#3|1|
|後日 甲 #1|3|
|#2|3|
|#3|1|
|#4|1|
|#5|1|
|翌日 #6|3|
|#7|1|
|#8|3|
|#9|3|
|#10|3|
|#11|3|
|#12|3|
|#13|3|
|#14|3|
|#15|1|

また、装甲破壊システムに関与しているとされている X セルの港湾棲鬼及び K セルの空母ヲ級についてはこのような現象は見られなかった(常にLv. 1)。  
イベントの装甲破壊システムとの関係性は不明。  
彼女の装備的に公式クライアントからレベルを確認することはできない(砲を装備していないため攻撃時にカットインが出ない)ため、プレイヤーに気づかせる気はないものと考えられる。  

以下は仮説であり、十分な検証が行われたものではない事を注記しておく。  
Lv. 3 の離島棲鬼には装甲破壊効果はないのではないかと思われる。  
理由としては、Lv. 1の離島棲鬼を破壊することで十分に装甲破壊効果が得られているためである。初回攻略時(上表 甲#1～#3 破壊後)において、敵旗艦装甲 333 ではありえないダメージを観測している。  
また、「 X, Y セルをそれぞれ3回破壊で十分な効果が得られる」というのが通説であったが、効果が実感できなかったとの報告もよく見られた。（編成に問題があったのかもしれないが…）  
上記調査においてはその出現はランダムであるように見えるため、効果のないほうを連続で引いてしまったのではないか、と推測する。  

ただ、上記報告において「全てLv. 3だった」場合においても攻略できていることを考えると、この仮説の正確性はかなり怪しい。単純に設定ミスであり、「レベルが違う」以外に意味はないという可能性も大きい。  

また、同イベント E-7-I において出現する潜水艦隊には「潜水カ級 elite」が2隻編成されているが、5番艦は Lv. 50 で6番艦は Lv. 1 であった。  
通常海域に出現するものはおそらく Lv. 50 のみである。こちらの関連も不明。


#### 異なるレベルを持つ敵艦

以下の敵艦は通常のものとは異なるレベルを持つ。

|敵艦|通常レベル|設定レベル|出現位置|位置備考|編成備考|
|:--|--:|--:|:--|:--|:--|
|潜水カ級|50|0|5-1-3|初手渦潮の次の潜水艦マス|5隻編成の潜水艦隊の5番艦|


#### 総合力の計算式

出撃直前に表示される「総合力」(レーダーチャートに表示されるもの)の計算式を以下に示す。

```
(艦船数≧1の場合)
表示値 = min( round( パラメータ / 艦船数 ) + round( round( パラメータ / 艦船数 ) * sqrt( 艦船数 - 1 ) ), 350 )

(艦船数=0の場合)
表示値 = 0

パラメータ = 各艦のパラメータ合計(装備込)
```

#### 戦闘糧食と秋刀魚の缶詰

*※注記：コードを流し読みしたものであり、検証中である。*  
両方持っている状態で発動した時、必ずどちらも発動する。(どちらか1つだけ発動することはない)。  
大本営曰く併用でより効果が上がるようだが、未検証。

#### 改装時に必要な開発資材

改装に必要な鋼材の量に依存する。
なお、設計図を1枚以上消費する改装においては常に 0 となる。

* < 4500 : 0
* < 5500 : 10
* < 6500 : 15
* ≧ 6500 : 20

2015/10/21現在、あてはまるのは翔鶴改二(甲)及び瑞鶴改二(甲)のみ。

#### 編成登録・展開の挙動

* 展開時に以下の状態である艦娘はスキップされる。全員がその状態の場合は展開できない。
    * 別の艦隊に所属している。
    * 除籍されている。
* 除籍された艦娘のIDはリストに残る（展開時には `×　除籍艦` と表示される）。但し、当該編成を展開した際にリストから削除される。
* 全員が除籍されたリストは自動的に削除される。
* 空いたスロットがあっても詰められることはない。(#2 のスロットが削除されても #3 は移動しない)

#### リソースIDについて
艦娘のグラフィックファイル名(リソースID)だが、秋刀魚祭りアップデート以降、グラフィック変更でもリソースIDが変更になることがある。  
( ex. Libeccio(ハロウィン仕様)の際、`nsutzbtifaji` -> `nsutzbtifami` )  
一部だけが書き換わっているところを見ると、単純なハッシュ値ではないのかもしれない。  

2015/12/08 アップデート(秋イベ終了)時のグラフィック更新(クリスマスシリーズ)では、上に述べたような変化は発生しなかった(ハロウィン仕様の艦のリソースIDは元に戻った)。

2016/01/01(新年晴れ着)アップデートにおいては、 `tuvoqtqrddem` -> `zzztuvoqtqrd` になるような変更が行われており、一貫性がない。

どうやらオンメンテによるグラフィック更新時に描画が崩れるのを防ぐ (描画座標は `api_start2` に入っているため、再読み込みせずに画像だけ更新されると表示位置がずれる) ためにこうなっているらしく、オンメンテ時のみ変更されうるようだ。

> リソースIDに使われている各文字の出現頻度を調べたところ、 a と z は他の文字に比べて出現率が半分であった。
> この文字列を求める計算式に何かしらの偏りがあるのかもしれない。

#### 揚陸地点について
揚陸時点で大破・退避していた場合、減少TP計算に含まれない。  
また、減少TP計算には揚陸地点に到達した時点での状況が使われる。  
揚陸地点通過後に大破・退避・沈没した、揚陸地点通過時に大破→ボス戦で女神復活した、ボス戦で戦闘糧食を食べたなどしても、減少TPは変わらない。  

#### 装甲破壊された敵艦のグラフィック
画像は `[リソースID]_d.swf` になる。  
装甲破壊されたかの判定は戦闘APIの ~~`api_boss_damaged`~~ `api_xal01` の参照で行う。  
また、ボイスは末尾が 0 から 1 になる( 例: `32464410` → `32464411` )。  
なお、2015/11/25 現在、上記フラグは通常艦隊・機動部隊昼戦時のみ存在し、水上部隊戦や夜戦時には存在しない模様。  

#### 改修リスト表示バグ
2016/02/24 ごろ（'16 冬イベアップデート以降?）から、「他」(艦隊未所属艦)の1ページ目に存在する艦を、第一艦隊所属艦(第二以降でも可?未確認)に近代化改修した後、再び「他」ページを開くと、近代化改修で除籍された艦がなぜかリストに残っており、表示が崩れる不具合がある。  
[選択する前は右側ペインが表示されない状態となり](https://twitter.com/andanteyk/status/700951095015641088)、何かの艦を選択すると[「リスト表示は艦が残ったままだが、選択は通常通り働く」](https://twitter.com/andanteyk/status/700952401201594368)という状態になる。  
（リストの1番目の艦を近代化改修に使用した場合、リストの1番目を選択すると「リストの艦名は使用した艦だが、右側の表示は現存する1番目の艦」といった状態になる。この状態で10番目の艦を選択すると、リスト外の艦を選択できる(ように見える)。）  
別のページを開くか近代化改修ページを開くと正常な状態に戻る。  

#### 彩雲装備時のT字不利
長距離空襲戦では、彩雲を装備していてもT字不利が発生することがある。  
[スクリーンショットはこちらを参照。](https://twitter.com/andanteyk/status/697771799849734144)  
最も、空襲戦では航空攻撃しか行われないため、陣形補正は働かずあまり意味はない。  


#### 洋上補給の複数発動について
2016/04/01 アップデートから(少なくとも04/17時点で)、洋上補給がボス到達時に任意で発動可能になったとともに、同時に複数個発動可能になった。  

回復量を以下に示す。

|消費個数|通常艦隊回復量|連合艦隊回復量|
|:--|--:|--:|
|1|25%|15%|
|2|???|???|
|3|47%|47%?|

ソースを以下に示す：  

* [1個使用(複数発動実装以前)](http://jbbs.shitaraba.net/bbs/read.cgi/netgame/13745/1400461230/989)  
    * 通常艦隊についてはこちらも実測して確認している。
* 3個使用・通常艦隊については実測した。燃弾20%でボス前発動→ボス戦夜戦なし終了→47%
* [3個使用・連合艦隊](https://twitter.com/Nishisonic/status/727837338416513025)  
    * [こちらも参照](https://twitter.com/Nishisonic/status/727853782801866752)


#### 基地航空隊関連の挙動

* 熟練度(少なくとも制空値ボーナス)は有効
* 敵偵察機も航空戦に参加する
    * そのため、敵の偵察機搭載数を測定できるかもしれない
* 局地戦闘機は「命中」が「対爆」、「回避」が「迎撃」と表示される
* 補給しなくとも配置転換すれば全機補充される
    * 但し配置コストがかかるので利用は難しい
* `api_start2` において、戦闘行動半径と配置コストが設定されていない場合（非航空機）、直前のIDの装備の値を引き継ぐ
    * そのため ID < 16(最初の航空機)までは項目自体が存在せず、それ以降の砲などにはゴミデータが入っている
* 配備時のボーキサイト消費は `コスト * 機数`
* 補給時の消費は `燃料 = 喪失機数 * 3`, `ボーキサイト = 喪失機数 * 5`


#### 敵潜水艦の先制雷撃
elite 級か flagship 級であれば先制雷撃を行う。  
味方側と違い、特殊潜航艇の装備有無は関与しない。  


#### 索敵フェーズで飛んでいく偵察機の選択

[ カテゴリ = ( 艦上偵察機 | 水上偵察機 | 水上爆撃機 | 大型飛行艇 ) かつ 搭載機数 > 0 ] であるスロットの中で、基準値( = 索敵 + √改修レベル )が最大なものを選択する。  
同値が複数存在した場合、先頭に近いほう( 旗艦第1スロ＞…＞旗艦第5スロ＞2番艦第1スロ＞… )を選択する。  
該当するものが存在しなかった場合( 艦攻のみで索敵成功など )は、デフォルトの 零式水上偵察機 が選択される。

